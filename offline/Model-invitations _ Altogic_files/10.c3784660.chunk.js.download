(this["webpackJsonpui-designer"]=this["webpackJsonpui-designer"]||[]).push([[10],{672:function(e,a,t){"use strict";var n=t(4),r=t(15),i=t(2),s=t.n(i),o=t(3),l=t(11),d=t(12),c=t(13),p=t(14),m=t(5),u=t.n(m),g=t(18),f=t(0),h=t(395),y=t.n(h),v=t(51),b=t(22),x=t(511),E=t(109),k=t(61),N=t(323),w=t(796),S=t(805),C=t(799),T=t(800),R=t(298),O=t(778),I=t(589),M=t(80),P=t(790),j=t(804),D=t(539),L=t(878),A=t(779),V=t(807),q=t(811),_=t(810),W=t(808),F=t(809),J=t(671),B=t(555),G=t(621),z=t(498),U=t(888),K=t(889),H=t(554),Y=t(299),Q=t(634),Z=t(82),$=t(328),X=t(81),ee=t(17),ae=t(330),te=t(60),ne=t(110),re=t(667),ie=t(806),se=function(e){Object(c.a)(t,e);var a=Object(p.a)(t);function t(){var e;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=a.call.apply(a,[this].concat(r))).validateName=function(a){var t=e.props.t,n=new ae.a;return n.add(n.trim).add(n.required,t("Required field, cannot be left empty.")).add(n.bail).add(n.textLength,t("Can be max {{length}} characters long.",{length:ee.a.maxMicroTxtLength}),{max:ee.a.maxMicroTxtLength}).validate(a)},e.onClose=function(){var a=e.props,t=a.reset,n=a.handleClose,r=a.cancelCallback;r&&r(),n(),t()},e.onSubmit=function(a){var t=e.props,n=t.reset,r=t.handleClose,i=t.createNodeGroupAction,l=t.user,d=t.app,c=t.callback;return new Promise(function(){var e=Object(o.a)(s.a.mark((function e(t,o){var p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(l._id,l.token,d._id,{name:a.name});case 2:200===(p=e.sent).status?(t(),r(),n(),c&&c(p.data)):o(new z.a(p.reduxForm));case 4:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}())},e}return Object(d.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,a=e.classes,t=e.t,n=e.theme,r=e.open,i=e.handleClose,s=e.fullWidth,o=e.maxWidth,l=e.handleSubmit,d=e.submitting,c=e.error;return u.a.createElement(w.a,{fullWidth:s,maxWidth:o,open:r,onClose:function(e,a){if("backdropClick"===a)return!1;i()},"aria-labelledby":"create-node-group-dialog"},u.a.createElement(S.a,{id:"create-node-group-dialog"},u.a.createElement(M.a,{component:"span",variant:"h6"},t("Create node group")),u.a.createElement(O.a,{"aria-label":"close",className:a.closeButton,onClick:this.onClose},u.a.createElement(Z.a,{icon:$.x,className:a.closeButtonIcon}))),u.a.createElement("form",{className:a.form,onSubmit:l(this.onSubmit),noValidate:!0},u.a.createElement(C.a,{classes:{root:a.dialogContentRoot}},c&&u.a.createElement(ie.a,{component:"div"},u.a.createElement(J.a,{severity:"error"}," ",this.renderError()," ")),u.a.createElement(B.a,{variant:"filled",color:"dark"===n.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,autoFocus:!0,name:"name",label:t("Group name"),id:"name",component:ae.g,autoComplete:"off",inputProps:{maxLength:ee.a.maxMicroTxtLength},helperText:t("Name of your node group"),validate:this.validateName})),u.a.createElement(T.a,{className:a.dialogActions},u.a.createElement(R.a,{type:"submit",variant:"contained",disableElevation:!0,color:"primary",disabled:d},d&&u.a.createElement(Y.a,{size:20,className:a.progress}),t("Create")),u.a.createElement(R.a,{variant:"contained",disableElevation:!0,onClick:this.onClose},t("Cancel")))))}},{key:"renderError",value:function(){var e=this.props.error;return e?u.a.createElement(M.a,{component:"div",variant:"body2",color:"error"},e):null}}]),t}(u.a.PureComponent),oe=Object(k.g)(Object(v.b)((function(e){return{user:e.user,app:e.app}}),{createNodeGroupAction:te.S})(Object(H.a)({form:"createNodeGroup",enableReinitialize:!0})(Object(b.a)((function(e){return{progress:{marginRight:e.spacing(1)},closeButton:{position:"absolute",right:e.spacing(2),padding:e.spacing(.5),color:e.palette.grey[400]},closeButtonIcon:{width:"24px",height:"24px",minWidth:"24px"},dialogContentRoot:{"&:first-child":{paddingTop:8}},dialogActions:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3),paddingTop:e.spacing(2),paddingBottom:e.spacing(2)}}}),{withTheme:!0})(Object(E.a)()(se))))),le=t(877),de=t(794),ce=t(550),pe=function(e){Object(c.a)(t,e);var a=Object(p.a)(t);function t(e){var n;return Object(l.a)(this,t),(n=a.call(this,e)).validateRequired=function(e){var a=n.props.t,t=new ae.a;return t.add(t.trim).add(t.required,a("Required field, cannot be left empty.")).validate(e)},n.validateName=function(e){var a=n.props.t,t=new ae.a;return t.add(t.trim).add(t.required,a("Required field, cannot be left empty.")).add(t.bail).add(t.textLength,a("Can be max {{length}} characters long.",{length:ee.a.maxMicroTxtLength}),{max:ee.a.maxMicroTxtLength}).add(t.bail).add(t.regex,a("Only numbers, letters, spaces and underscore '_' characters allowed."),{regex:/^[A-Za-z0-9_ ]+$/}).add(t.bail).add(t.notStartsWith,a("Names cannot start with underscore (_) character."),{searchStr:"_"}).add(t.bail).add(t.notStartsWithNumber,a("Names cannot start with a number.")).add(t.bail).add(t.notMongoId,a("Names cannot be in object id format.")).validate(e)},n.validateParamName=function(e){var a=n.props,t=a.t,r=a.allParams,i=a.param,s=a.inputLinks,o=n.validateName(e);if(o)return o;if("this"===e.trim().toLowerCase()||"errors"===e.trim().toLowerCase()||"inputs"===e.trim().toLowerCase()||"client"===e.trim().toLowerCase())return t("'%s' is a reserved name and cannot be used").sprintf(e);if(s)for(var l=0;l<s.length;l++){if(s[l].name.trim().toLowerCase()===e.trim().toLowerCase())return t("An input link point with the provided name exists. Node parameter names and input link point names should be different.")}if(r&&0!==r.length){for(var d=0,c=0;c<r.length;c++){r[c].name.trim().toLowerCase()===e.trim().toLowerCase()&&d++}return!i&&d>0||i&&d>1?t("Node parameter with the provided name already exists"):void 0}},n.processOptions=function(e){var a=n.props,t=a.t,r=a.change,i=a.formValues;if(!i)return null;if(!e)return r("radiogroup"===i.type?"paramConfig.radioOptions":"paramConfig.selectOptions",[]),t("At least one option needs to be specified");var s=e.split("\n").filter((function(e){var a=e.trim();if(!a)return!1;var t=a.split(";");return 2===t.length&&!(!t[0].trim()||!t[1].trim())})).map((function(e){var a=e.trim().split(";");return{value:a[0].trim(),label:a[1].trim()}}));return i.defaultValue&&!s.filter((function(e){return e.value===i.defaultValue}))&&r("defaultValue",null),r("radiogroup"===i.type?"paramConfig.radioOptions":"paramConfig.selectOptions",s),0===s.length?t("At least one option needs to be specified"):void 0},n.onClose=function(){var e=n.props,a=e.reset;(0,e.handleClose)(),a()},n.onSubmit=function(e){var a=n.props,t=a.t,r=a.reset,i=a.handleClose,l=a.validateMultiExpressionAction,d=a.user,c=a.app,p=a.activeSnap,m=a.callback,u=n.state.activeTab;return new Promise(function(){var a=Object(o.a)(s.a.mark((function a(o,g){var f,h,y,v,b,x,E,k,N,w;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(f=[],(h=n.getDynamicModels()).length>0&&(y=h[0],f.push({name:"this",modeliname:y.iname,lookups:[]})),6===e.paramConfig.returnType&&(e.paramConfig.returnType=5),v=[],b=0,e.validationRuleExpStr&&e.validationRuleExpStr.trim()&&(v.push({name:"validationRuleExpStr",title:t("Validation rule expression"),expStr:e.validationRuleExpStr}),b++),e.validationErrorExpStr&&e.validationErrorExpStr.trim()&&(v.push({name:"validationErrorExpStr",title:t("Error message expression"),expStr:e.validationErrorExpStr}),b++),e.defaultValueExpStr&&e.defaultValueExpStr.trim()&&v.push({name:"defaultValueExpStr",title:t("Default value expression"),expStr:e.defaultValueExpStr}),0!==v.length){a.next=15;break}return m&&m(e),o(),i(),r(),a.abrupt("return");case 15:if(1!==b){a.next=18;break}return g(new z.a({_error:t("Either default value or error message expression is missing. When one of the expressions is specified the other expression cannot be left empty.")})),a.abrupt("return");case 18:return a.next=20,l(d._id,d.token,c?c._id:null,p?p._id:null,{expressions:v,context:f,dynamicModels:h||[],ignoreTransient:!0});case 20:if(200!==(x=a.sent).status){a.next=45;break}E=!1,k={},N=0;case 25:if(!(N<x.data.length)){a.next=35;break}if(!1!==(w=x.data[N]).success){a.next=31;break}return E=!0,k[w.name]=w.response.message,a.abrupt("continue",32);case 31:"defaultValueExpStr"===w.name&&w.response&&e.paramConfig.returnType!==w.response.returnType&&(E=!0,k[w.name]=t('"Default value" expression should return a value of type "%s". Current expression returns list of "%s" type value.').sprintf(n.getReturnTypeText(e.paramConfig.returnType),n.getReturnTypeText(w.response.returnType)),"1"===u&&(k._error=t("Invalid default value expression. The default value expression return type and the parameter type do not match.")));case 32:N++,a.next=25;break;case 35:if(!E){a.next=39;break}return n.setState({validationResult:x.data}),g(new z.a(k)),a.abrupt("return");case 39:m&&m(e),o(),i(),r(),a.next=46;break;case 45:g(new z.a(t("An error has occured")));case 46:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())},n.state={activeTab:"0",validationResult:null},n}return Object(d.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,a=e.classes,t=e.t,n=e.open,r=e.handleClose,i=e.fullWidth,s=e.maxWidth,o=e.handleSubmit,l=e.width,d=e.param,c=e.submitting;return u.a.createElement(w.a,{fullWidth:i,maxWidth:s,fullScreen:"xs"===l,open:n,onClose:function(e,a){if("backdropClick"===a)return!1;r()},"aria-labelledby":"manage-node-param-dialog",classes:{paper:"xs"===l?null:a.dialogPaper,scrollPaper:a.scrollYAuto},scroll:"paper"},u.a.createElement(S.a,{id:"manage-node-param-dialog"},u.a.createElement(M.a,{component:"span",variant:"h6"},t(d?"Edit node parameter":"Create node parameter")),u.a.createElement(O.a,{"aria-label":"close",className:a.closeButton,onClick:this.onClose},u.a.createElement(Z.a,{icon:$.x,className:a.closeButtonIcon}))),u.a.createElement("form",{className:a.dialogForm,onSubmit:o(this.onSubmit),noValidate:!0},u.a.createElement(C.a,{classes:{root:a.dialogContentRoot}},this.renderTabs(),this.renderError(),this.renderStandard(),this.renderAdvanced()),u.a.createElement(T.a,{className:a.dialogActions},u.a.createElement(R.a,{type:"submit",variant:"contained",disableElevation:!0,color:"primary",disabled:c},c&&u.a.createElement(Y.a,{size:20,className:a.progress}),t(d?"Update":"Create")),u.a.createElement(R.a,{variant:"contained",disableElevation:!0,onClick:this.onClose},t("Cancel")))))}},{key:"renderError",value:function(){var e=this.state,a=e.validationResult,t=e.activeTab,n=this.props,r=n.t,i=n.formErrors,s=n.error,o=n.formValues,l=null,d=null,c=null;if(i&&(void 0!==i.name||void 0!==i.description||void 0!==i.title||void 0!==i.defaultValueExpStr&&o&&"expression"===o.type)&&"1"===t&&(l=u.a.createElement(J.a,{severity:"error"},void 0!==i.name&&u.a.createElement("div",null,r("Parameter name is not valid. A valid parameter name needs to be specified.")),void 0!==i.description&&u.a.createElement("div",null,r("Parameter description is missing. A valid parameter description needs to be specified.")),void 0!==i.title&&u.a.createElement("div",null,r("Parameter title is missing. A valid parameter title needs to be specified.")),void 0!==i.defaultValueExpStr&&u.a.createElement("div",null,r("Invalid default value expression. The default value expression return type and the parameter type do not match.")))),a&&a.length>0&&"0"===t){var p=a.filter((function(e){return!1===e.success}));p.length>0&&(d=u.a.createElement(J.a,{severity:"error"},p.map((function(e,a){return u.a.createElement("div",{key:a},e.title,":\xa0",e.response.name)}))))}return s&&(c=u.a.createElement(J.a,{severity:"error"},u.a.createElement("div",null,s))),u.a.createElement(u.a.Fragment,null,l,d,c)}},{key:"renderTabs",value:function(){var e=this,a=this.props,t=a.t,n=a.classes,r=this.state.activeTab;return u.a.createElement("div",{className:n.tabList},u.a.createElement(le.a,{value:r,onChange:function(a,t){return e.setState({activeTab:t})},indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto"},u.a.createElement(de.a,{value:"0",label:u.a.createElement("div",{className:n.tabTextWrapper},t("Basic")),classes:{root:n.tabRoot}}),u.a.createElement(de.a,{value:"1",label:u.a.createElement("div",{className:n.tabTextWrapper},t("Advanced")),classes:{root:n.tabRoot}})))}},{key:"renderStandard",value:function(){var e=this.state.activeTab,a=this.props,t=a.classes,n=a.t,r=a.theme,i=a.readOnly,s=a.change;return u.a.createElement("div",{style:{display:"0"===e?"block":"none"}},u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(Q.a,{item:!0,xs:6},u.a.createElement(B.a,{variant:"filled",color:"dark"===r.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,name:"title",label:n("Properties panel title"),component:ae.g,autoComplete:"off",inputProps:{maxLength:ee.a.maxMicroTxtLength},helperText:n("Node properties panel title of the param"),validate:this.validateRequired,disabled:i})),u.a.createElement(Q.a,{item:!0,xs:6},u.a.createElement(B.a,{variant:"filled",color:"dark"===r.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,autoFocus:!0,name:"name",label:n("Param name"),component:ae.g,autoComplete:"off",inputProps:{maxLength:ee.a.maxMicroTxtLength},helperText:n("Unique name of the param"),validate:this.validateParamName,disabled:i})),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(B.a,{variant:"filled",color:"dark"===r.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,name:"description",label:n("Description"),component:ae.g,autoComplete:"off",multiline:!0,rows:3,inputProps:{maxLength:ee.a.maxLongTxtLength},validate:this.validateRequired,helperText:n("Brief description of the param"),disabled:i})),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(B.a,{name:"required",label:u.a.createElement("div",{className:t.body2},u.a.createElement(x.a,{defaults:n("<bold>Required parameter</bold>, the value of the parameter cannot be left empty"),components:{bold:u.a.createElement("strong",null)}})),component:ae.d,dense:!0,disabled:i})),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(B.a,{color:"dark"===r.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:!0,name:"type",label:n("Widget used to set param value"),component:ae.f,validate:this.validateRequired,helperText:n("The UI component of the param that will be used to get user input"),disabled:i,onChange:function(){return s("defaultValue",null)}},u.a.createElement(P.a,{value:"expression",className:t.body2},u.a.createElement(Z.a,{icon:X.Ib,style:{marginRight:r.spacing(1)},fixedWidth:!0}),n("Expression")),u.a.createElement(P.a,{value:"radiogroup",className:t.body2},u.a.createElement(Z.a,{icon:X.lc,style:{marginRight:r.spacing(1)},fixedWidth:!0}),n("Radio group")),u.a.createElement(P.a,{value:"checkbox",className:t.body2},u.a.createElement(Z.a,{icon:X.G,style:{marginRight:r.spacing(1)},fixedWidth:!0}),n("Checkbox (true/false)")),u.a.createElement(P.a,{value:"select",className:t.body2},u.a.createElement(Z.a,{icon:X.M,style:{marginRight:r.spacing(1)},fixedWidth:!0}),n("Select")),u.a.createElement(P.a,{value:"edit_email",className:t.body2},u.a.createElement(Z.a,{icon:X.d,style:{marginRight:r.spacing(1)},fixedWidth:!0}),n("Text edit")),u.a.createElement(P.a,{value:"edit_json",className:t.body2},u.a.createElement(Z.a,{icon:X.t,style:{marginRight:r.spacing(1)},fixedWidth:!0}),n("JSON edit")))),this.renderParamSpecificProps(),this.renderDefaultValue()))}},{key:"renderParamSpecificProps",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.formValues,i=e.readOnly;if(!r)return null;switch(r.type){case"expression":return u.a.createElement(B.a,{color:"dark"===n.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:!0,name:"paramConfig.returnType",label:a("Expression return value type"),component:ae.f,validate:this.validateRequired,helperText:a("The type of value that the expression will return when evaluated. For date-time values you can select integer type."),disabled:i},u.a.createElement(P.a,{value:1,className:t.body2},u.a.createElement(Z.a,{icon:X.Uc,style:{marginRight:n.spacing(1)},fixedWidth:!0}),a("Integer value")),u.a.createElement(P.a,{value:2,className:t.body2},u.a.createElement(Z.a,{icon:X.Ac,style:{marginRight:n.spacing(1)},fixedWidth:!0}),a("Decimal value")),u.a.createElement(P.a,{value:3,className:t.body2},u.a.createElement(Z.a,{icon:X.td,style:{marginRight:n.spacing(1)},fixedWidth:!0}),a("Boolean value")),u.a.createElement(P.a,{value:4,className:t.body2},u.a.createElement(Z.a,{icon:X.nd,style:{marginRight:n.spacing(1)},fixedWidth:!0}),a("Text value")),u.a.createElement(P.a,{value:5,className:t.body2},u.a.createElement(Z.a,{icon:X.b,style:{marginRight:n.spacing(1)},fixedWidth:!0}),a("Object or list value")));case"checkbox":return u.a.createElement(B.a,{variant:"filled",color:"dark"===n.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,name:"paramConfig.label",label:a("Checkbox label"),component:ae.g,autoComplete:"off",helperText:a("The label of the checkbox that will be displayed to the user"),validate:this.validateRequired,disabled:i});case"select":case"radiogroup":return u.a.createElement(u.a.Fragment,null,u.a.createElement(B.a,{variant:"filled",color:"dark"===n.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,name:"radiogroup"===r.type?"paramConfig.radioOptionsRaw":"paramConfig.selectOptionsRaw",label:"radiogroup"===r.type?a("Radio group options"):a("Select list options"),component:ae.g,autoComplete:"off",multiline:!0,rows:5,helperText:a("Copy and paste a list of options. Please separate multiple options with a new line. Each option should have a value and a name pair separated by a semicolumn (;)"),placeholder:a("option value1;option name1\noption value2;option name2"),validate:this.processOptions,disabled:i}),u.a.createElement("div",{style:{marginTop:n.spacing(1)}},this.getOptionsCount()));default:return null}}},{key:"getOptionsCount",value:function(){var e=this.props,a=e.t,t=e.theme,n=e.formValues,r=null;return n&&n.type&&n.paramConfig&&(r="radiogroup"===n.type?n.paramConfig.radioOptions:n.paramConfig.selectOptions),r&&0!==r.length?1===r.length?u.a.createElement("span",{style:{color:t.palette.success.main}},a("1 valid option specified")):u.a.createElement("span",{style:{color:t.palette.success.main}},a("%s valid options specified").sprintf(r.length)):u.a.createElement("span",{style:{color:t.palette.error.main}},a("No valid option specified"))}},{key:"renderAdvanced",value:function(){var e=this.state.activeTab,a=this.props,t=a.t,n=a.classes,r=a.width,i=a.readOnly,s=a.user,o=a.app,l=a.activeSnap,d=a.systemModels,c=a.formValues,p=a.formErrors,m=a.change,g=[],f=this.getDynamicModels();if(f.length>0){var h=f[0];g.push({context:"this",name:h.name,model:h,lookups:[],specialInput:!1})}return u.a.createElement("div",{style:{display:"1"===e?"block":"none"}},u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{className:n.info},t("For special checks on parameter values such as checking a parameter's value with respect to the values assigned to some other parameters, you can define a validation rule and associated error message that is returned in case the validation rule fails (when rule expression evaluates to false).")),u.a.createElement(ce.a,{compLabel:t("Validation rule expression"),compName:"validationRuleExpStr",readOnly:i||p&&void 0!==p.name,width:r,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:f,modelsContext:g,required:!1,change:m,expStr:c&&c.validationRuleExpStr,multiline:!0,rows:"3",returnType:3})),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(ce.a,{compLabel:t("Error message expression"),compName:"validationErrorExpStr",readOnly:i||p&&void 0!==p.name,width:r,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:f,modelsContext:g,required:!1,change:m,expStr:c&&c.validationErrorExpStr,multiline:!0,rows:"3",returnType:4}))))}},{key:"renderDefaultValue",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.formValues,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=e.width,m="expression";switch(i&&i.type&&(m=i.type),m){case"expression":var g=[],f=this.getDynamicModels();if(f.length>0){var h=f[0];g.push({context:"this",name:h.name,model:h,lookups:[],specialInput:!1})}var y=i&&i.paramConfig.returnType;return 6===y&&(y=5),u.a.createElement(ce.a,{compLabel:a("Default value"),compName:"defaultValueExpStr",readOnly:r,width:p,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:f,modelsContext:g,required:!1,change:c,expStr:i&&i.defaultValueExpStr,multiline:!0,rows:"3",returnType:y});case"checkbox":return u.a.createElement(B.a,{color:"dark"===n.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,name:"defaultValue",label:a("Default value"),component:ae.f,helperText:a("Default value of the node parameter"),disabled:r},u.a.createElement(P.a,{value:!0,className:t.body2},a("True")),u.a.createElement(P.a,{value:!1,className:t.body2},a("False")));case"radiogroup":return u.a.createElement(B.a,{color:"dark"===n.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,name:"defaultValue",label:a("Default value"),component:ae.f,helperText:a("Default value of the node parameter"),disabled:r},u.a.createElement(P.a,{key:-1,value:null,className:t.body2},a("<none>")),i.paramConfig&&i.paramConfig.radioOptions&&i.paramConfig.radioOptions.map((function(e,a){return u.a.createElement(P.a,{key:a,value:e.value,className:t.body2},e.label)})));case"select":return u.a.createElement(B.a,{color:"dark"===n.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,name:"defaultValue",label:a("Default value"),component:ae.f,helperText:a("Default value of the node parameter"),disabled:r},u.a.createElement(P.a,{key:-1,value:null,className:t.body2},a("<none>")),i.paramConfig&&i.paramConfig.selectOptions&&i.paramConfig.selectOptions.map((function(e,a){return u.a.createElement(P.a,{key:a,value:e.value,className:t.body2},e.label)})));case"edit_email":case"edit_json":default:return null}}},{key:"getNewId",value:function(){return y()().toHexString()}},{key:"getDynamicModels",value:function(){var e=this,a=this.props,t=a.getDynamicModels,r=a.param,i=a.formErrors,s=a.formValues,o=t();if(!r&&!i.name&&s&&s.type&&o&&o.length>0){var l=this.getParamType(s);return"object"===l?o[0].fields.push({_id:this.getNewId(),type:l,transient:!0,name:s.name,iname:this.getNewId(),object:{iname:null}}):"object-list"===l?o[0].fields.push({_id:this.getNewId(),type:l,transient:!0,name:s.name,iname:this.getNewId(),objectList:{iname:null}}):o[0].fields.push({_id:this.getNewId(),type:l,transient:!0,name:s.name,iname:this.getNewId()}),o}if(r&&!i.name&&o&&o.length>0){var d=o[0];return d.fields=d.fields.map((function(a){var t=e.getParamType(s);if(a.name===r.name){var i=Object(n.a)({},a);return i.name=s.name,i.type=t,"object"===t?i.object={iname:null}:"object-list"===t&&(i.objectList={iname:null}),i}return a})),o}return o}},{key:"getParamType",value:function(e){switch(e.type){case"expression":switch(e.paramConfig.returnType){case 1:return"integer";case 2:return"decimal";case 3:return"boolean";case 4:return"text";case 5:return"object";case 6:return"object-list";default:return"text"}case"checkbox":return"boolean";case"radiogroup":case"select":case"edit_email":return"text";case"edit_json":return"object";default:return"text"}}},{key:"getReturnTypeText",value:function(e){var a=this.props.t,t=e;if(!1===Array.isArray(e)&&(t=[e]),t.length>1){for(var n=[],r=0;r<t.length-1;r++){var i=t[r];n.push(this.getTypeText(i))}return n.join(", ")+(2===t.length?a(" or "):a(", or "))+this.getTypeText(t[t.length-1])}for(var s=[],o=0;o<t.length;o++){var l=t[o];s.push(this.getTypeText(l))}return s.join(", ")}},{key:"getTypeText",value:function(e){var a=this.props.t;switch(e){case 1:return a("integer");case 2:return a("decimal");case 3:return a("boolean");case 4:return a("text");case 5:return a("object");default:return a("none")}}}]),t}(u.a.PureComponent);pe.defaultProps={user:null,app:null,activeSnap:null,systemModels:[],param:null,allParams:null,callback:null,readOnly:!1,getDynamicModels:null,inputLinks:null};var me=Object(k.g)(Object(v.b)((function(e,a){var t={title:"",name:"",description:"",type:"expression",required:!0,defaultValue:null,defaultValueExpStr:null,validationRuleExpStr:null,validationErrorExpStr:null,paramConfig:{returnType:4}};return a.param&&(t=a.param),{user:e.user,initialValues:t,formValues:Object(U.a)("manageNodeParam")(e),formErrors:Object(K.a)("manageNodeParam")(e)}}),{validateMultiExpressionAction:te.ag})(Object(H.a)({form:"manageNodeParam",enableReinitialize:!0})(Object(N.a)()(Object(b.a)((function(e){return{dialogPaper:{minHeight:"810px"},dialogForm:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"stretch",alignContent:"flex-start",flexWrap:"nowrap"},progress:{marginRight:e.spacing(1)},closeButton:{position:"absolute",right:e.spacing(2),padding:e.spacing(.5),color:e.palette.grey[400]},closeButtonIcon:{width:"24px",height:"24px",minWidth:"24px"},dialogContentRoot:{"&:first-child":{paddingTop:8},display:"flex",flexDirection:"column",flexGrow:1},dialogActions:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3),paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},body2:{fontSize:e.typography.body2.fontSize},tabList:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:e.palette.divider,marginBottom:e.spacing(2),borderTopLeftRadius:e.shape.borderRadius,borderTopRightRadius:e.shape.borderRadius},tabTextWrapper:{display:"flex",flexDirection:"row",alignItems:"center"},tabRoot:{minWidth:0},info:{padding:e.spacing(1,0),color:e.palette.text.disabled,fontSize:e.typography.caption.fontSize},scrollYAuto:{overflowY:"auto"}}}),{withTheme:!0})(Object(E.a)()(pe)))))),ue=t(635),ge=t(326),fe=t(551),he=function(e){Object(c.a)(t,e);var a=Object(p.a)(t);function t(e){var n;return Object(l.a)(this,t),(n=a.call(this,e)).validateContent=function(e){var a=n.props,t=a.t,r=a.required;if((!e||""===e.trim())&&r)return t("A document needs to be provided")},n.showExp=function(){n.setState({openExpDialog:!0})},n.hideExp=function(){n.setState({openExpDialog:!1})},n.state={openExpDialog:!1},n}return Object(d.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,a=e.t,t=e.theme,n=e.classes,r=e.readOnly,i=e.width,s=e.compName,o=e.compLabel,l=e.rows,d=e.multiline,c=this.state.openExpDialog;return u.a.createElement(u.a.Fragment,null,u.a.createElement(B.a,{color:"dark"===t.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,name:s,label:o,component:ae.g,autoComplete:"off",multiline:d,rows:l,disabled:r,helperText:u.a.createElement("span",null,a("Click on"),u.a.createElement(Z.a,{icon:ge.o,style:{margin:t.spacing(0,.5)}}),a("to launch editor.")),inputProps:{style:{borderLeftColor:t.palette.divider,borderLeftWidth:"1px",borderLeftStyle:"solid",paddingLeft:t.spacing(1),fontSize:"xs"===i||"sm"===i?t.typography.body1.fontSize:t.typography.caption.fontSize,fontFamily:'"Lucida Console", Monaco, "Courier New"'},spellCheck:"false"},InputProps:{startAdornment:u.a.createElement(ue.a,{position:"start"},u.a.createElement(O.a,{color:"primary",className:n.jsonEditButton,disabled:r,onClick:this.showExp},u.a.createElement(Z.a,{icon:ge.o,className:n.textEdit,fixedWidth:!0})))},validate:this.validateContent}),c&&this.renderExpressionDialog())}},{key:"renderExpressionDialog",value:function(){var e=this.props,a=e.t,t=e.change,n=e.models,r=e.modelsContext,i=e.systemModels,s=e.dynamicModels,o=e.contents,l=e.compName,d=e.activeSnap,c=this.state.openExpDialog,p=n.concat(i).concat(s);return u.a.createElement(fe.a,{fullWidth:!0,maxWidth:"md",open:c,handleClose:this.hideExp,callback:function(e){t(l,e.trim())},models:r,fullList:p,dynamicModels:s,contents:o||"",type:"json",title:a("Edit JSON document"),activeSnap:d})}}]),t}(u.a.PureComponent);he.defaultProps={compName:null,compLabel:null,readOnly:!1,width:null,user:null,app:null,activeSnap:null,models:[],systemModels:[],dynamicModels:[],modelsContext:[],change:null,contents:null,rows:6,multiline:!0,required:!1};var ye=Object(b.a)((function(e){return{jsonEditButton:{padding:e.spacing(.5)},textEdit:{width:"20px",height:"20px",minWidth:"20px",fontSize:e.typography.body2.fontSize}}}),{withTheme:!0})(Object(E.a)()(he)),ve=t(337),be=function(e){Object(c.a)(t,e);var a=Object(p.a)(t);function t(e){var n;return Object(l.a)(this,t),(n=a.call(this,e)).renderLinkPoints=function(e){var a=e.fields,t=e.classes,r=e.t,i=e.theme,s=e.readOnly,o=(e.width,e.change),l=null;return a&&(l=a.map((function(e,l){var d=a.get(l);return u.a.createElement(u.a.Fragment,{key:l},u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{className:Object(g.default)(t.entry,t.body2,t.uppercase)},u.a.createElement("div",{style:{flexGrow:1}},r("Input link point"),"\xa0#",l+1),u.a.createElement(O.a,{onClick:function(){return a.remove(l)},className:t.button,disabled:s||1===a.length},u.a.createElement(Z.a,{icon:X.wd,className:t.buttonIcon})))),u.a.createElement(Q.a,{item:!0,xs:6},u.a.createElement(B.a,{color:"dark"===i.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:!0,name:"".concat(e,".name"),label:r("Name"),component:ae.g,autoComplete:"off",inputProps:{maxLength:ee.a.maxMicroTxtLength},validate:n.validateInputName,disabled:s,helperText:r("Name of input link point")})),u.a.createElement(Q.a,{item:!0,xs:6},u.a.createElement(B.a,{color:"dark"===i.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:!0,name:"".concat(e,".type"),label:r("Type"),component:ae.f,disabled:s,validate:n.validateRequired,helperText:r("Type of input link point"),onChange:function(a){"trigger"===a.target.value&&o("".concat(e,".isFile"),!1)}},u.a.createElement(P.a,{value:"trigger",className:t.body2},r("Trigger")),u.a.createElement(P.a,{value:"object",className:t.body2},r("Object")),u.a.createElement(P.a,{value:"list",className:t.body2},r("List")))),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{className:t.paddingLeft},u.a.createElement(B.a,{name:"".concat(e,".isFile"),label:u.a.createElement("div",{className:t.body2},u.a.createElement(x.a,{defaults:r('Only <bold>objects of "File" model</bold> will be accepted by this link point'),components:{bold:u.a.createElement("strong",null)}})),component:ae.d,dense:!0,disabled:s||"trigger"===d.type}))),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(B.a,{variant:"filled",color:"dark"===i.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,name:"".concat(e,".description"),label:r("Description"),component:ae.g,autoComplete:"off",multiline:!0,rows:4,inputProps:{maxLength:ee.a.maxLongTxtLength},validate:n.validateRequired,helperText:r("Brief description of input link point"),disabled:s})))}))),u.a.createElement(u.a.Fragment,null,l,u.a.createElement(Q.a,{item:!0,xs:12,className:t.lastRow},u.a.createElement(I.a,{href:"#",onClick:s||a.length>=5?null:function(){return a.push({name:"",type:"object",isFile:!1,description:""})},className:s||a.length>=10?t.disabledLink:null},u.a.createElement(Z.a,{icon:X.Dc,style:{marginRight:i.spacing(1)}}),r("Add input link point"))))},n.renderEntries=function(e){var a=e.fields,t=e.type,n=e.classes,r=e.t,i=e.theme,s=e.readOnly,o=e.width,l=e.user,d=e.app,c=e.activeSnap,p=e.systemModels,m=e.dynamicModels,f=e.modelContext,h=e.change,y=null;return a&&(y=a.map((function(e,i){var y=a.get(i);return u.a.createElement(u.a.Fragment,{key:i},u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{className:Object(g.default)(n.entry,n.caption,n.bold)},u.a.createElement("div",{style:{flexGrow:1}},r("query"===t?"Parameter":"Header"),"\xa0#",i+1),u.a.createElement(O.a,{onClick:function(){return a.remove(i)},className:Object(g.default)(n.button,n.position),disabled:s},u.a.createElement(Z.a,{icon:X.wd,className:n.buttonIcon})))),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(ce.a,{compLabel:r("Key"),compName:"".concat(e,".keyExp"),readOnly:s,width:o,user:l,app:d,activeSnap:c,models:[],systemModels:p,dynamicModels:m,modelsContext:f,required:!0,change:h,expStr:y.keyExp,returnType:4,multiline:!1})),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(ce.a,{compLabel:r("Value"),compName:"".concat(e,".valueExp"),readOnly:s,width:o,user:l,app:d,activeSnap:c,models:[],systemModels:p,dynamicModels:m,modelsContext:f,required:!0,change:h,expStr:y.valueExp,returnType:[1,2,3,4,5,-1],multiline:!1})))}))),u.a.createElement(u.a.Fragment,null,y,u.a.createElement(Q.a,{item:!0,xs:12,className:n.lastRow},u.a.createElement(I.a,{href:"#",onClick:s?null:function(){return a.push({keyExp:null,valueExp:null})},className:s?n.disabledLink:null},u.a.createElement(Z.a,{icon:X.Dc,style:{marginRight:i.spacing(1)}}),r("query"===t?"Add query parameter":"Add header"))))},n.renderBodyEntries=function(e){var a=e.fields,t=e.type,n=e.classes,r=e.t,i=e.theme,s=e.readOnly,o=e.width,l=e.user,d=e.app,c=e.activeSnap,p=e.systemModels,m=e.dynamicModels,f=e.modelContext,h=e.change,y=null;return a&&(y=a.map((function(e,i){var y=a.get(i);return u.a.createElement(u.a.Fragment,{key:i},u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{className:Object(g.default)(n.entry,n.caption,n.bold)},u.a.createElement("div",{style:{flexGrow:1}},r("formdata"===t?"Formdata parameter":"multipart"===t?"Part parameter":"URL encoded parameter"),"\xa0#",i+1),u.a.createElement(O.a,{onClick:function(){return a.remove(i)},className:Object(g.default)(n.button,n.position),disabled:s},u.a.createElement(Z.a,{icon:X.wd,className:n.buttonIcon})))),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(ce.a,{compLabel:r("Key"),compName:"".concat(e,".keyExp"),readOnly:s,width:o,user:l,app:d,activeSnap:c,models:[],systemModels:p,dynamicModels:m,modelsContext:f,required:!0,change:h,expStr:y.keyExp,returnType:4,multiline:!1})),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(B.a,{name:"".concat(e,".jsonFormat"),label:u.a.createElement("div",{className:n.body2},r("Parameter value in JSON format")),component:ae.d,dense:!0})),u.a.createElement(Q.a,{item:!0,xs:12},y.jsonFormat?u.a.createElement(ye,{compName:"".concat(e,".valueJson"),compLabel:r("JSON document"),readOnly:s,width:o,user:l,app:d,activeSnap:c,models:[],systemModels:p,dynamicModels:m,modelsContext:f,change:h,contents:y.valueJson,rows:10,required:!0}):u.a.createElement(ce.a,{compLabel:r("Value"),compName:"".concat(e,".valueExp"),readOnly:s,width:o,user:l,app:d,activeSnap:c,models:[],systemModels:p,dynamicModels:m,modelsContext:f,required:!0,change:h,expStr:y.valueExp,returnType:[1,2,3,4,5,-1],multiline:!1})))}))),u.a.createElement(u.a.Fragment,null,y,u.a.createElement(Q.a,{item:!0,xs:12,className:n.lastRow2},u.a.createElement(I.a,{href:"#",onClick:s?null:function(){return a.push({keyExp:null,valueExp:null,valueJson:null,jsonFormat:!1})},className:s?n.disabledLink:null},u.a.createElement(Z.a,{icon:X.Dc,style:{marginRight:i.spacing(1)}}),r("formdata"===t?"Add formdata parameter":"multipart"===t?"Add part parameter":"Add URL encoded parameter"))))},n.renderParts=function(e){var a=e.fields,t=e.classes,r=e.t,i=e.theme,s=e.readOnly,o=e.width,l=e.user,d=e.app,c=e.activeSnap,p=e.systemModels,m=e.dynamicModels,f=e.modelContext,h=e.change,y=null;return a&&(y=a.map((function(e,y){return u.a.createElement(u.a.Fragment,{key:y},u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{className:Object(g.default)(t.entry,t.caption,t.bold)},u.a.createElement("div",{style:{flexGrow:1}},r("Part"),"\xa0#",y+1),u.a.createElement(O.a,{onClick:function(){return a.remove(y)},className:Object(g.default)(t.button,t.position),disabled:s},u.a.createElement(Z.a,{icon:X.wd,className:t.buttonIcon})))),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{style:{paddingLeft:i.spacing(4)}},u.a.createElement(G.a,{name:"".concat(e,".contents"),component:n.renderBodyEntries,props:{type:"multipart",classes:t,t:r,theme:i,readOnly:s,width:o,user:l,app:d,activeSnap:c,systemModels:p,dynamicModels:m,modelContext:f,change:h}}))))}))),u.a.createElement(u.a.Fragment,null,y,u.a.createElement(Q.a,{item:!0,xs:12,className:t.lastRow2},u.a.createElement(I.a,{href:"#",onClick:s?null:function(){return a.push({contents:null})},className:s?t.disabledLink:null},u.a.createElement(Z.a,{icon:X.Dc,style:{marginRight:i.spacing(1)}}),r("Add body part"))))},n.validateNodeName=function(e){var a=n.validateName(e);if(a)return a},n.validateName=function(e){var a=n.props.t,t=new ae.a;return t.add(t.trim).add(t.required,a("Required field, cannot be left empty.")).add(t.bail).add(t.textLength,a("Can be max {{length}} characters long.",{length:ee.a.maxMicroTxtLength}),{max:ee.a.maxMicroTxtLength}).validate(e)},n.validateRequired=function(e){var a=n.props.t,t=new ae.a;return t.add(t.trim).add(t.required,a("Required field, cannot be left empty.")).validate(e)},n.validateFieldName=function(e){var a=n.props.t,t=new ae.a;return t.add(t.trim).add(t.required,a("Required field, cannot be left empty.")).add(t.bail).add(t.textLength,a("Can be max {{length}} characters long.",{length:ee.a.maxMicroTxtLength}),{max:ee.a.maxMicroTxtLength}).add(t.bail).add(t.regex,a("Only numbers, letters and underscore '_' allowed."),{regex:/^[A-Za-z0-9_]+$/}).add(t.bail).add(t.notStartsWith,a("Names cannot start with underscore (_) character."),{searchStr:"_"}).add(t.bail).add(t.notStartsWithNumber,a("Names cannot start with a number.")).add(t.bail).add(t.notMongoId,a("Names cannot be in object id format.")).validate(e)},n.validateInputName=function(e,a){var t=n.props.t;if(a&&a.design&&a.design.params)for(var r=0;r<a.design.params.length;r++){var i=a.design.params[r];if(e&&i.name.trim().toLowerCase()===e.trim().toLowerCase())return t("A node parameter with the provided name exists. Node parameter names and input link point names should be different.")}if(a&&a.design&&a.design.inputs){var s=n.validateFieldName(e);if(s)return s;if("this"===e.trim().toLowerCase()||"errors"===e.trim().toLowerCase())return t("'%s' is a reserved name and cannot be used").sprintf(e);for(var o=0,l=0;l<a.design.inputs.length;l++){var d=a.design.inputs[l];d.name&&d.name.trim().toLowerCase()===e.trim().toLowerCase()&&o++}return o>1?t("Input link point with the provided name already exists"):void 0}},n.takePrevAction=function(){var e=n.getStepInfo();n.setState({step:n.steps[e.index-2].key,validating:!1,internalError:null,validationResult:null,syntaxErrors:[]})},n.takeNextAction=function(){var e=n.getStepInfo();e.index===n.steps.length-1&&n.validateNodeConfig(),n.setState({step:n.steps[e.index].key})},n.getDynamicModels=function(){var e=n.props.formValues,a=n.createModelJson("_nodeParams",n.getNewId(),null,"model");if(e&&e.design&&e.design.params)for(var t=e.design.params,r=0;r<t.length;r++){var i=t[r],s=n.creteFieldJson(i.name,n.getNewId(),n.getParamType(i));"object"===s.type?s.object={iname:null}:"object-list"===s.type&&(s.objectList={iname:null}),a.fields.push(s)}if(e&&e.design&&e.design.inputs)for(var o=0;o<e.design.inputs.length;o++){var l=e.design.inputs[o];if(l.isFile){var d=n.creteFieldJson(l.name,n.getNewId(),"object");d.object={iname:"file"},a.fields.push(d)}}var c=n.buildClientModel(a.iname),p=n.creteFieldJson("client",n.getNewId(),"object");return p.object={iname:c.iname},a.fields.push(p),[a,c]},n.onClose=function(){var e=n.props,a=e.reset;(0,e.handleClose)(),a()},n.onSubmit=function(e){var a=n.props,t=a.reset,r=a.handleClose,i=a.createAppNodeAction,l=a.updateAppNodeAction,d=a.addNodeToRepoAction,c=a.updateNodeInRepoAction,p=a.user,m=a.app,u=a.callback,g=a.node,f=a.isRepoNode;return new Promise(function(){var a=Object(o.a)(s.a.mark((function a(o,h){var y,v;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(y=n.getInfoCard(e),v=null,g){a.next=14;break}if(!f){a.next=9;break}return a.next=6,d(p._id,p.token,null,null,{name:e.name,type:e.type,groupId:-1===e.groupId?null:e.groupId,isDraft:!1,design:{infoCard:y,raw:e}});case 6:v=a.sent,a.next=12;break;case 9:return a.next=11,i(p._id,p.token,m._id,{name:e.name,type:e.type,groupId:-1===e.groupId?null:e.groupId,isDraft:!1,design:{infoCard:y,raw:e}});case 11:v=a.sent;case 12:a.next=23;break;case 14:if(!f){a.next=20;break}return a.next=17,c(p._id,p.token,g._id,{name:e.name,groupId:-1===e.groupId?null:e.groupId,isDraft:!1,marketStatus:g.marketStatus,design:{infoCard:y,raw:e}});case 17:v=a.sent,a.next=23;break;case 20:return a.next=22,l(p._id,p.token,m._id,g._id,{name:e.name,groupId:-1===e.groupId?null:e.groupId,isDraft:!1,marketStatus:g.marketStatus,design:{infoCard:y,raw:e}});case 22:v=a.sent;case 23:200===v.status?(o(),r(),t(),u&&u(v.data)):h(new z.a(v.reduxForm));case 24:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())},n.saveDraft=Object(o.a)(s.a.mark((function e(){var a,t,r,i,o,l,d,c,p,m,u,g,f,h,y,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.props,t=a.t,r=a.reset,i=a.handleClose,o=a.createAppNodeAction,l=a.updateAppNodeAction,d=a.addNodeToRepoAction,c=a.updateNodeInRepoAction,p=a.user,m=a.app,u=a.callback,g=a.node,f=a.formValues,h=a.isRepoNode,n.setState({savingDraft:!0}),y=n.getInfoCard(f),v=null,g){e.next=16;break}if(!h){e.next=11;break}return e.next=8,d(p._id,p.token,null,null,{name:f.name,type:f.type,groupId:-1===f.groupId?null:f.groupId,isDraft:!0,design:{infoCard:y,raw:f}});case 8:v=e.sent,e.next=14;break;case 11:return e.next=13,o(p._id,p.token,m._id,{name:f.name,type:f.type,groupId:-1===f.groupId?null:f.groupId,isDraft:!0,design:{infoCard:y,raw:f}});case 13:v=e.sent;case 14:e.next=25;break;case 16:if(!h){e.next=22;break}return e.next=19,c(p._id,p.token,g._id,{name:f.name,groupId:-1===f.groupId?null:f.groupId,isDraft:!1,marketStatus:g.marketStatus,design:{infoCard:y,raw:f}});case 19:v=e.sent,e.next=25;break;case 22:return e.next=24,l(p._id,p.token,m._id,g._id,{name:f.name,groupId:-1===f.groupId?null:f.groupId,isDraft:!0,marketStatus:g.marketStatus,design:{infoCard:y,raw:f}});case 24:v=e.sent;case 25:200===v.status?(i(),r(),u&&u(v.data)):n.setState({internalError:t("An internal error has occured. %s").sprintf(v.data.details),savingDraft:!1});case 26:case"end":return e.stop()}}),e)}))),n.setNodeGroup=function(e){(0,n.props.change)("groupId",e._id)},n.setPrevNodeGroup=function(){var e=n.state.groupId;(0,n.props.change)("groupId",e)},n.steps=[{index:1,key:"name",name:e.t("Name & description"),description:e.t("Please give a descriptive name to your REST API node and provide brief description about its functionality.")},{index:2,key:"inputs",name:e.t("Input link points"),description:e.t("Define the input link points structure of your node, both for fixed and dynamically added ones.")},{index:3,key:"outputs",name:e.t("Output link point"),description:e.t("Define the output link point type of your node and output object model.")},{index:4,key:"params",name:e.t("Node parameters"),description:e.t("The node's parameters that will be displayed in the node properties panel and specified by the user.")},{index:5,key:"endpoint_auth",name:e.t("Endpoint & authentication method"),description:e.t("Define the desired action (method) to be performed on the REST API resource (endpoint) using the provided authentication credentials.")},{index:6,key:"query",name:e.t("Query parameters"),description:e.t("Define the set of parameters that will be attached to the end of the endpoint URL to help define specific content or actions.")},{index:7,key:"headers",name:e.t("Request headers"),description:e.t("Define name-value pairs that will be used to pass additional information with the HTTP request.")},{index:8,key:"body",name:e.t("Request body"),description:e.t("Define the REST API call request body type and how the body parameters of the request will be sent to the API endpoint.")},{index:9,key:"validate",name:e.t("Validation results"),description:null}],n.state={step:"name",showModelDialog:!1,showParamDialog:!1,currentParam:null,currentParamIndex:-1,validating:!1,validationResult:null,syntaxErrors:[],design:null,internalError:null,savingDraft:!1,openCreateNodeGroupDialog:!1,groupId:null},n}return Object(d.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,a=e.classes,t=e.t,n=e.open,r=e.handleClose,i=e.fullWidth,s=e.maxWidth,o=e.width,l=e.node;return u.a.createElement(w.a,{fullWidth:i,maxWidth:s,fullScreen:"xs"===o,open:n,onClose:function(e,a){if("backdropClick"===a)return!1;r()},"aria-labelledby":"create-app-node-dialog",classes:{paper:"xs"===o?null:a.dialogPaper,scrollPaper:a.scrollYAuto},scroll:"paper"},u.a.createElement(S.a,{id:"create-app-node-dialog"},u.a.createElement(M.a,{component:"span",variant:"h6"},t(l?"Edit REST API node":"Create REST API node")),u.a.createElement(O.a,{"aria-label":"close",className:a.closeButton,onClick:this.onClose},u.a.createElement(Z.a,{icon:$.x,className:a.closeButtonIcon}))),u.a.createElement("form",{className:a.dialogForm,noValidate:!0},this.renderStepper(),u.a.createElement(C.a,{classes:{root:a.dialogContentRoot}},this.renderError(),this.renderContent()),this.renderButtons()))}},{key:"renderError",value:function(){var e=this.state.internalError,a=this.props,t=a.classes,n=a.error;return n||e?u.a.createElement("div",{className:t.errorRow},u.a.createElement(J.a,{severity:"error"},u.a.createElement(M.a,{component:"div",variant:"body2",color:"error"},n||e))):null}},{key:"renderStepper",value:function(){var e=this.props,a=e.t,t=e.classes,n=this.getStepInfo();return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:Object(g.default)(t.stepperRow,t.bottomMargin)},u.a.createElement("div",{className:Object(g.default)(t.bold,t.primary,t.padding,t.ml2),style:{flexGrow:1}},a("Step"),"\xa0",n.index,"/",this.steps.length,":\xa0",n.name)),n.description&&u.a.createElement("div",{className:Object(g.default)(t.bottomMargin,t.lrmargin)},u.a.createElement(J.a,{severity:"info",icon:!1},n.description)))}},{key:"renderContent",value:function(){switch(this.state.step){case"name":return this.renderNameAndDesc();case"inputs":return this.renderInputs();case"outputs":return this.renderOutputs();case"params":return this.renderParameters();case"endpoint_auth":return this.renderEndpointAuth();case"query":return this.renderQueryParams();case"headers":return this.renderHeaders();case"body":return this.renderBody();case"validate":return this.renderValidationResult();default:return null}}},{key:"renderNameAndDesc",value:function(){var e=this,a=this.state.openCreateNodeGroupDialog,t=this.props,n=t.t,r=t.classes,i=t.theme,s=t.readOnly,o=t.app,l=t.authAction,d=t.formValues,c=t.isRepoNode,p=l("create-node",{app:o});return u.a.createElement("div",{className:r.contentRow},u.a.createElement(B.a,{variant:"filled",color:"dark"===i.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,autoFocus:!0,name:"name",label:n("Name"),id:"name",component:ae.g,autoComplete:"off",inputProps:{maxLength:ee.a.maxMicroTxtLength},helperText:n("Name of your REST API node"),validate:this.validateNodeName,disabled:s}),u.a.createElement(B.a,{color:"dark"===i.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:!0,name:"groupId",label:n("Group"),component:ae.f,helperText:n("Group/category of your REST API node"),validate:this.validateRequired,disabled:s||c},o&&1===p&&u.a.createElement(P.a,{key:"new",value:"new",className:r.body2,onClick:function(){return e.setState({openCreateNodeGroupDialog:!0,groupId:d.groupId})}},u.a.createElement(Z.a,{icon:X.Dc,style:{marginRight:i.spacing(1.5),fontSize:"1rem"},fixedWidth:!0}),n("Add new node group")),o&&1===p&&u.a.createElement(j.a,null),u.a.createElement(P.a,{key:-1,value:-1,className:r.body2},n("No group")),o&&o.nodeGroups&&o.nodeGroups.length>0&&u.a.createElement(j.a,null),o&&o.nodeGroups&&o.nodeGroups.map((function(e){return u.a.createElement(P.a,{key:e._id,value:e._id,className:r.body2},e.name)}))),u.a.createElement(B.a,{variant:"filled",color:"dark"===i.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,name:"design.description",label:n("Description"),id:"description",component:ae.g,autoComplete:"off",multiline:!0,rows:10,inputProps:{maxLength:ee.a.maxDetailTxtLength},validate:this.validateRequired,helperText:n("Brief description of the node, what the node does and how it should be be used etc."),disabled:s}),a&&u.a.createElement(oe,{fullWidth:!0,maxWidth:"sm",open:a,handleClose:function(){return e.setState({openCreateNodeGroupDialog:!1})},callback:this.setNodeGroup,cancelCallback:this.setPrevNodeGroup}))}},{key:"renderInputs",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.formValues,o=e.change;return u.a.createElement("div",{className:t.contentRow},u.a.createElement("div",{className:Object(g.default)(t.bottomMargin,t.paddingLeft)},u.a.createElement(B.a,{name:"design.multiInput",label:u.a.createElement("div",{className:t.body2},u.a.createElement(x.a,{defaults:a("This node is a <bold>multi-input node</bold>, which will allow the addition of new input link points by users during service design besides the ones defined below"),components:{bold:u.a.createElement("strong",null)}})),onChange:function(e){!1===e.target.checked&&o("design.listInputRestricted",!1)},component:ae.d,dense:!0,disabled:r}),u.a.createElement(B.a,{name:"design.listInputRestricted",label:u.a.createElement("div",{className:t.body2},u.a.createElement(x.a,{defaults:a("Do not allow addition of list type link points (only applicable when multi-input node is selected)"),components:{bold:u.a.createElement("strong",null)}})),component:ae.d,dense:!0,disabled:r||s&&s.design&&!1===s.design.multiInput})),u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(G.a,{name:"design.inputs",component:this.renderLinkPoints,props:{classes:t,t:a,theme:n,readOnly:r,width:i,change:o}})))}},{key:"renderOutputs",value:function(){var e=this,a=this.state.showModelDialog,t=this.props,n=t.t,r=t.classes,i=t.theme,s=t.readOnly,o=t.formValues,l=t.change,d=t.width,c=t.user,p=t.app,m=t.systemModels,f=t.activeSnap,h="custom",y=null;o&&o.design&&o.design.output&&(h=o.design.output.modelType,y=o.design.output.modelDefinition);var v=[],b=this.getDynamicModels();if(b.length>0){var x=b[0];v.push({context:"this",name:x.name,model:x,lookups:[],specialInput:!1})}return u.a.createElement("div",{className:r.contentRow},u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(Q.a,{item:!0,xs:6},u.a.createElement(B.a,{color:"dark"===i.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:!0,name:"design.output.name",label:n("Name"),component:ae.g,autoComplete:"off",inputProps:{maxLength:ee.a.maxMicroTxtLength},validate:this.validateInputName,disabled:s,helperText:n("Name of output link point")})),u.a.createElement(Q.a,{item:!0,xs:6},u.a.createElement(B.a,{color:"dark"===i.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:!0,name:"design.output.type",label:n("Type"),component:ae.f,disabled:s,validate:this.validateRequired,helperText:n("Type of output link point")},u.a.createElement(P.a,{value:"trigger",className:r.body2},n("Trigger")),u.a.createElement(P.a,{value:"object",className:r.body2},n("Object")),u.a.createElement(P.a,{value:"list",className:r.body2},n("List")))),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(B.a,{variant:"filled",color:"dark"===i.palette.type?"secondary":"primary",margin:"dense",fullWidth:!0,required:!0,name:"design.output.description",label:n("Description"),component:ae.g,autoComplete:"off",multiline:!0,rows:4,inputProps:{maxLength:ee.a.maxLongTxtLength},validate:this.validateRequired,helperText:n("Brief description of output link point"),disabled:s})),o&&o.design&&o.design.output&&"trigger"!==o.design.output.type&&u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{className:Object(g.default)(r.entry,r.body2,r.uppercase,r.bottomMargin)},u.a.createElement("div",{style:{flexGrow:1}},n("REST API response model definition"))),u.a.createElement("div",null,u.a.createElement(B.a,{name:"design.output.modelType",component:ae.e},u.a.createElement(A.a,{value:"file",control:u.a.createElement(L.a,{className:r.dense,color:"primary",disabled:s}),label:n("File object model"),classes:{label:r.body2},style:{paddingLeft:i.spacing(1)}}),u.a.createElement(A.a,{value:"custom",control:u.a.createElement(L.a,{className:r.dense,color:"primary",disabled:s}),label:n("Custom response model"),classes:{label:r.body2},style:{paddingLeft:i.spacing(1)}}))),"custom"===h&&u.a.createElement("div",{className:r.topMargin},y&&y.length>0?u.a.createElement("div",{style:{marginBottom:i.spacing(1),color:s?i.palette.text.disabled:i.palette.text.primary}},u.a.createElement(Z.a,{icon:X.jd,style:{marginRight:i.spacing(.5)}}),y[0].name,u.a.createElement(R.a,{color:"primary",size:"small",variant:"contained",disabled:s,onClick:function(){return e.setState({showModelDialog:!0})},disableElevation:!0,style:{marginLeft:i.spacing(1)}},n(y?"Edit response model":"Define response model"))):u.a.createElement("div",{style:{marginBottom:i.spacing(1),color:i.palette.error.main}},n("No model specified yet"),u.a.createElement(R.a,{color:"primary",size:"small",variant:"contained",disabled:s,onClick:function(){return e.setState({showModelDialog:!0})},disableElevation:!0,style:{marginLeft:i.spacing(1)}},n(y?"Edit response model":"Define response model"))),u.a.createElement("div",null,u.a.createElement(ce.a,{compLabel:n('Response model path (array of string values e.g., ["path1", "path2", ...])'),compName:"design.config.responseObjPath",readOnly:s,width:d,user:c,app:p,activeSnap:f,models:[],systemModels:m,dynamicModels:b,modelsContext:v,required:!1,change:l,expStr:o&&o.design&&o.design.config&&o.design.config.responseObjPath,returnType:5,arrayValueType:4,rows:3,isPrimitivesArray:!0})),a&&u.a.createElement(re.a,{fullWidth:!0,maxWidth:"md",open:a,handleClose:function(){return e.setState({showModelDialog:!1})},callback:function(e){l("design.output.modelDefinition",e)},allModels:[],modelDefinition:y})))))}},{key:"renderParameters",value:function(){var e=this,a=this.state,t=a.showParamDialog,n=a.currentParam,r=this.props,i=r.t,s=r.classes,o=r.theme,l=r.readOnly,d=r.formValues,c=r.user,p=r.app,m=r.activeSnap,g=r.systemModels,f=[];return d&&d.design&&d.design.params&&(f=d.design.params),u.a.createElement("div",{className:s.contentRow},u.a.createElement(V.a,{stickyHeader:!0,size:"small"},u.a.createElement(W.a,null,u.a.createElement(F.a,null,u.a.createElement(_.a,null,u.a.createElement(Z.a,{icon:X.ld,style:{marginRight:o.spacing(1)}}),u.a.createElement("span",{className:s.bold},i("Name"))),u.a.createElement(_.a,null,u.a.createElement(Z.a,{icon:X.Cb,style:{marginRight:o.spacing(1)}}),u.a.createElement("span",{className:s.bold},i("Type"))),u.a.createElement(_.a,{width:"100px",className:s.contextMenuCell},"\xa0"))),u.a.createElement(q.a,null,f.map((function(a,t){return u.a.createElement(F.a,{key:t},u.a.createElement(_.a,null,u.a.createElement(I.a,{href:"#",onClick:function(){return e.setState({showParamDialog:!0,currentParam:a,currentParamIndex:t})}},a.name)),u.a.createElement(_.a,null,e.renderParamType(a.type)),u.a.createElement(_.a,null,u.a.createElement("div",{style:{display:"flex",flexDirection:"row-reverse"}},u.a.createElement(O.a,{onClick:function(){return e.deleteParam(t)},className:s.button,disabled:l},u.a.createElement(Z.a,{icon:X.wd,className:s.buttonIcon})),f.length>1&&u.a.createElement(O.a,{onClick:function(){return e.moveParamDown(t)},className:s.button,disabled:l},u.a.createElement(Z.a,{icon:X.K,className:s.buttonIcon})),f.length>1&&u.a.createElement(O.a,{onClick:function(){return e.moveParamUp(t)},className:s.button,disabled:l},u.a.createElement(Z.a,{icon:X.L,className:s.buttonIcon})))))})))),u.a.createElement("div",{className:s.topMargin},u.a.createElement(I.a,{href:"#",onClick:l?null:function(){return e.setState({showParamDialog:!0,currentParam:null,currentParamIndex:-1})},className:l?s.disabledLink:null},u.a.createElement(Z.a,{icon:X.Dc,style:{marginRight:o.spacing(1)}}),i("Add node parameter"))),t&&u.a.createElement(me,{fullWidth:!0,maxWidth:"sm",open:t,handleClose:function(){return e.setState({showParamDialog:!1,currentParam:null,currentParamIndex:-1})},callback:function(a){e.manageParamDefinition(a)},param:n,allParams:f,readOnly:l,user:c,app:p,activeSnap:m,systemModels:g,getDynamicModels:this.getDynamicModels,inputLinks:d&&d.design&&d.design.inputs}))}},{key:"renderParamType",value:function(e){var a=this.props,t=a.t,n=a.theme,r=null,i=null;switch(e){case"expression":r=t("Expression"),i=X.Ib;break;case"radiogroup":r=t("Radio group"),i=X.lc;break;case"checkbox":r=t("Checkbox"),i=X.J;break;case"select":r=t("Select"),i=X.M;break;case"edit_email":r=t("Text edit"),i=X.d;break;case"edit_json":r=t("JSON edit"),i=X.t;break;default:r=t("Expression"),i=X.Ib}return u.a.createElement("span",null,u.a.createElement(Z.a,{icon:i,style:{marginRight:n.spacing(1)}}),r)}},{key:"renderEndpointAuth",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=e.formValues,m=[],g=this.getDynamicModels();if(g.length>0){var f=g[0];m.push({context:"this",name:f.name,model:f,lookups:[],specialInput:!1})}var h="noauth";p&&p.design&&p.design.config&&p.design.config.authentication&&(h=p.design.config.authentication);var y=!1,v=!1,b=!1,x=!1,E=!1,k=!1;return"apikey"===h?(y=!0,v=!0,b=!0):"bearer"===h?x=!0:"basic"===h&&(E=!0,k=!0),u.a.createElement("div",{className:t.contentRow},u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(Q.a,{item:!0,xs:6},u.a.createElement(B.a,{color:"dark"===n.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,name:"design.config.httpMethod",label:a("HTTP method"),component:ae.f,disabled:r,validate:this.validateRequired},u.a.createElement(P.a,{value:"GET",className:t.body2},a("GET")),u.a.createElement(P.a,{value:"POST",className:t.body2},a("POST")),u.a.createElement(P.a,{value:"PUT",className:t.body2},a("PUT")),u.a.createElement(P.a,{value:"PATCH",className:t.body2},a("PATCH")),u.a.createElement(P.a,{value:"DELETE",className:t.body2},a("DELETE")))),u.a.createElement(Q.a,{item:!0,xs:6}),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement(ce.a,{compLabel:a("Endpoint"),compName:"design.config.endpoint",readOnly:r,width:i,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:g,modelsContext:m,required:!0,change:c,expStr:p&&p.design&&p.design.config&&p.design.config.endpoint,returnType:4,rows:2})),u.a.createElement(Q.a,{item:!0,xs:12},u.a.createElement("div",{style:{paddingLeft:n.spacing(1)}},u.a.createElement(D.a,{name:"authentication",value:h,onChange:function(e){c("design.config.authentication",e.target.value)}},u.a.createElement(A.a,{value:"noauth",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("No authentication"),classes:{label:t.body2}}),u.a.createElement(A.a,{value:"apikey",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("API key"),classes:{label:t.body2}}),"apikey"===h&&u.a.createElement("div",{style:{paddingLeft:n.spacing(4)}},u.a.createElement(ce.a,{compLabel:a("API key name"),compName:"design.config.apiKeyName",readOnly:r,width:i,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:g,modelsContext:m,required:y,change:c,expStr:p&&p.design&&p.design.config&&p.design.config.apiKeyName,returnType:4,multiline:!1}),u.a.createElement(ce.a,{compLabel:a("API key value"),compName:"design.config.apiKeyValue",readOnly:r,width:i,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:g,modelsContext:m,required:v,change:c,expStr:p&&p.design&&p.design.config&&p.design.config.apiKeyValue,returnType:4,multiline:!1}),u.a.createElement(B.a,{color:"dark"===n.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,name:"design.config.apiKeyAddTo",label:a("Add to"),component:ae.f,disabled:r,required:b,validate:this.validateRequired},u.a.createElement(P.a,{value:"header",className:t.body2},a("Header")),u.a.createElement(P.a,{value:"query",className:t.body2},a("Query param")))),u.a.createElement(A.a,{value:"bearer",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("Bearer token"),classes:{label:t.body2}}),"bearer"===h&&u.a.createElement("div",{style:{paddingLeft:n.spacing(4)}},u.a.createElement(ce.a,{compLabel:a("Token"),compName:"design.config.bearerToken",readOnly:r,width:i,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:g,modelsContext:m,required:x,change:c,expStr:p&&p.design&&p.design.config&&p.design.config.bearerToken,returnType:4,multiline:!1})),u.a.createElement(A.a,{value:"basic",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("Basic authentication"),classes:{label:t.body2}}),"basic"===h&&u.a.createElement("div",{style:{paddingLeft:n.spacing(4)}},u.a.createElement(ce.a,{compLabel:a("Username"),compName:"design.config.username",readOnly:r,width:i,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:g,modelsContext:m,required:E,change:c,expStr:p&&p.design&&p.design.config&&p.design.config.username,returnType:4,multiline:!1}),u.a.createElement(ce.a,{compLabel:a("Password"),compName:"design.config.password",readOnly:r,width:i,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:g,modelsContext:m,required:k,change:c,expStr:p&&p.design&&p.design.config&&p.design.config.password,returnType:4,multiline:!1})))))))}},{key:"renderQueryParams",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=[],m=this.getDynamicModels();if(m.length>0){var g=m[0];p.push({context:"this",name:g.name,model:g,lookups:[],specialInput:!1})}return u.a.createElement("div",{className:t.contentRow},u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(G.a,{name:"design.config.queryParams",component:this.renderEntries,props:{type:"query",classes:t,t:a,theme:n,readOnly:r,width:i,user:s,app:o,activeSnap:l,systemModels:d,dynamicModels:m,modelContext:p,change:c}})))}},{key:"renderHeaders",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=[],m=this.getDynamicModels();if(m.length>0){var g=m[0];p.push({context:"this",name:g.name,model:g,lookups:[],specialInput:!1})}return u.a.createElement("div",{className:t.contentRow},u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(G.a,{name:"design.config.headers",component:this.renderEntries,props:{type:"header",classes:t,t:a,theme:n,readOnly:r,width:i,user:s,app:o,activeSnap:l,systemModels:d,dynamicModels:m,modelContext:p,change:c}})))}},{key:"renderBody",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=e.formValues,m="none";p&&p.design&&p.design.config&&p.design.config.bodyType&&(m=p.design.config.bodyType);var g=[],f=this.getDynamicModels();if(f.length>0){var h=f[0];g.push({context:"this",name:h.name,model:h,lookups:[],specialInput:!1})}return u.a.createElement("div",{className:t.contentRow},u.a.createElement("div",{style:{paddingLeft:n.spacing(1)}},u.a.createElement(D.a,{name:"bodyType",value:m,onChange:function(e){c("design.config.bodyType",e.target.value)}},u.a.createElement(A.a,{value:"none",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("None"),classes:{label:t.body2}}),u.a.createElement(A.a,{value:"formdata",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("multipart/form-data"),classes:{label:t.body2}}),"formdata"===m&&u.a.createElement("div",{style:{paddingLeft:n.spacing(4)}},this.renderFormData()),u.a.createElement(A.a,{value:"multipart",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("multipart/related"),classes:{label:t.body2}}),"multipart"===m&&u.a.createElement("div",{style:{paddingLeft:n.spacing(4)}},this.renderMultipart()),u.a.createElement(A.a,{value:"urlencoded",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("application/x-www-form-urlencoded"),classes:{label:t.body2}}),"urlencoded"===m&&u.a.createElement("div",{style:{paddingLeft:n.spacing(4)}},this.renderUrlEncoded()),u.a.createElement(A.a,{value:"json",control:u.a.createElement(L.a,{className:t.dense,color:"primary",disabled:r}),label:a("application/json"),classes:{label:t.body2}}),"json"===m&&u.a.createElement("div",{style:{paddingLeft:n.spacing(4)}},u.a.createElement(ye,{compName:"design.config.applicationJson",compLabel:a("JSON document"),readOnly:r,width:i,user:s,app:o,activeSnap:l,models:[],systemModels:d,dynamicModels:f,modelsContext:g,change:c,contents:p&&p.design&&p.design.config&&p.design.config.applicationJson,rows:10,required:!0})))))}},{key:"renderFormData",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=[],m=this.getDynamicModels();if(m.length>0){var g=m[0];p.push({context:"this",name:g.name,model:g,lookups:[],specialInput:!1})}return u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(G.a,{name:"design.config.formData",component:this.renderBodyEntries,props:{type:"formdata",classes:t,t:a,theme:n,readOnly:r,width:i,user:s,app:o,activeSnap:l,systemModels:d,dynamicModels:m,modelContext:p,change:c}}))}},{key:"renderMultipart",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=[],m=this.getDynamicModels();if(m.length>0){var g=m[0];p.push({context:"this",name:g.name,model:g,lookups:[],specialInput:!1})}return u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(G.a,{name:"design.config.multipart",component:this.renderParts,props:{classes:t,t:a,theme:n,readOnly:r,width:i,user:s,app:o,activeSnap:l,systemModels:d,dynamicModels:m,modelContext:p,change:c}}))}},{key:"renderUrlEncoded",value:function(){var e=this.props,a=e.t,t=e.classes,n=e.theme,r=e.readOnly,i=e.width,s=e.user,o=e.app,l=e.activeSnap,d=e.systemModels,c=e.change,p=[],m=this.getDynamicModels();if(m.length>0){var g=m[0];p.push({context:"this",name:g.name,model:g,lookups:[],specialInput:!1})}return u.a.createElement(Q.a,{container:!0,spacing:1},u.a.createElement(G.a,{name:"design.config.urlEncoded",component:this.renderBodyEntries,props:{type:"urlencoded",classes:t,t:a,theme:n,readOnly:r,width:i,user:s,app:o,activeSnap:l,systemModels:d,dynamicModels:m,modelContext:p,change:c}}))}},{key:"renderValidationResult",value:function(){var e=this,a=this.state,t=a.validating,n=a.validationResult,r=a.syntaxErrors,i=this.props,s=i.t,o=i.classes,l=i.theme,d=r;if(n&&(d=d.concat(n)),t)return u.a.createElement("div",{className:o.contentRow,style:{display:"flex",alignItems:"center",justifyContent:"center"}},u.a.createElement(ve.a,{message:s("Validating ...")}));if(d.length>0){var c=this.hasErrors(d);return u.a.createElement("div",{className:o.contentRow},c?u.a.createElement(J.a,{severity:"error",className:o.bottomMargin},s("Validation has failed!")):u.a.createElement(J.a,{severity:"success",className:o.bottomMargin},s("Success! No errors identified.")),this.steps.map((function(a,t){if(t===e.steps.length)return null;var n=e.getStepErrors(d,a.key);return u.a.createElement("div",{key:t,style:{padding:l.spacing(1,0)}},u.a.createElement("div",{className:o.bold},u.a.createElement(Z.a,{icon:n.length>0?X.pb:X.H,style:{marginRight:l.spacing(.5),color:n.length>0?l.palette.error.main:l.palette.success.main},fixedWidth:!0}),u.a.createElement("span",null,s("Step"),"\xa0",a.index,":\xa0",a.name)),n.length>0&&u.a.createElement(J.a,{severity:"error",icon:!1,style:{marginTop:l.spacing(1)}},n.map((function(e,a){return u.a.createElement("div",{key:a,className:Object(g.default)(o.caption,o.padding)},e.title,":\xa0",e.response.message)}))))})),!1===c&&u.a.createElement(J.a,{severity:"info",icon:!1,style:{marginTop:l.spacing(2)}},u.a.createElement(x.a,{defaults:s("Altogic always <bold>uses a copy</bold> of the version of the custom node available during new service designs. <bold>If you have already used this node in your services and want to have the changes reflected, then you need to delete and recreate this node in respective services.</bold>"),components:{bold:u.a.createElement("strong",null)}})))}return null}},{key:"hasErrors",value:function(e){if(!e)return!1;for(var a=0;a<e.length;a++){if(!1===e[a].success)return!0}return!1}},{key:"getStepErrors",value:function(e,a){for(var t=[],n=0;n<e.length;n++){var r=e[n];r.name===a&&!1===r.success&&t.push(r)}return t}},{key:"renderButtons",value:function(){var e=this,a=this.state,t=a.validating,n=a.internalError,r=a.validationResult,i=a.syntaxErrors,s=a.savingDraft,o=this.props,l=o.t,d=o.classes,c=o.theme,p=o.handleSubmit,m=o.submitting,g=o.node,f=o.readOnly,h=this.getStepInfo(),y=i;return r&&(y=y.concat(r)),u.a.createElement(T.a,{className:d.dialogActions},u.a.createElement("div",{className:d.leftAction},u.a.createElement(R.a,{variant:"contained",disableElevation:!0,onClick:this.onClose},l("Cancel")),(1!==h.index&&(!g||!0===g.isDraft)||1===h.index&&!1===this.isDisabled()&&(!g||!0===g.isDraft))&&u.a.createElement(R.a,{variant:"contained",disableElevation:!0,onClick:this.saveDraft,disabled:t||m,style:{marginLeft:c.spacing(1)}},s&&u.a.createElement(Y.a,{size:20,className:d.progress}),l("Save draft")),g&&!f&&h.index!==this.steps.length&&!1===g.isDraft&&u.a.createElement(R.a,{variant:"contained",disableElevation:!0,onClick:function(){e.validateNodeConfig(),e.setState({step:"validate"})},style:{marginLeft:c.spacing(1)}},l("Validate"))),1!==h.index&&u.a.createElement(R.a,{variant:"contained",disableElevation:!0,onClick:this.takePrevAction},l("Previous")),u.a.createElement(R.a,{variant:"contained",disableElevation:!0,color:"primary",onClick:h.index!==this.steps.length?this.takeNextAction:p(this.onSubmit),disabled:this.isDisabled()||t||null!==n||this.hasErrors(y)||m||g&&f&&h.index===this.steps.length},m&&u.a.createElement(Y.a,{size:20,className:d.progress}),h.index===this.steps.length?l("Finish"):l("Next")))}},{key:"getStepInfo",value:function(){var e=this.state.step;return this.steps.find((function(a){return a.key===e}))}},{key:"isDisabled",value:function(){var e=this.state.step,a=this.props,t=a.formErrors,n=a.formValues;switch(e){case"name":if(t.name||t.design&&t.design.description)return!0;break;case"inputs":if(t.design&&t.design.inputs)for(var r=0;r<t.design.inputs.length;r++){var i=t.design.inputs[r];if(!1===this.isEmpty(i))return!0}break;case"outputs":if(t.design&&t.design.output){var s=t.design.output;if(s.name||s.type||s.description||s.modelType)return!0}if(n&&n.design&&"custom"===n.design.output.modelType&&"trigger"!==n.design.output.type&&(!n.design.output.modelDefinition||0===n.design.output.modelDefinition.length))return!0;if(n&&n.design&&n.design.config&&n.design.config.responseObjPath&&!n.design.config.responseObjPath_isValid)return!0;break;case"params":return!1;case"endpoint_auth":var o="noauth",l=t.design&&t.design.config;if(n&&n.design&&n.design.config&&n.design.config.authentication&&(o=n.design.config.authentication),l&&l.httpMethod)return!0;if(n&&n.design&&n.design.config&&(!n.design.config.endpoint||!n.design.config.endpoint.trim()||!n.design.config.endpoint_isValid))return!0;if("apikey"===o&&(!n.design.config.apiKeyName||!n.design.config.apiKeyName.trim()||!n.design.config.apiKeyName_isValid||!n.design.config.apiKeyValue||!n.design.config.apiKeyValue.trim()||!n.design.config.apiKeyValue_isValid||l&&l.apiKeyAddTo))return!0;if("bearer"===o&&(!n.design.config.bearerToken||!n.design.config.bearerToken.trim()||!n.design.config.bearerToken_isValid))return!0;if("basic"===o&&(!n.design.config.username||!n.design.config.username.trim()||!n.design.config.username_isValid||!n.design.config.password||!n.design.config.password.trim()||!n.design.config.password_isValid))return!0;break;case"query":if(n&&n.design&&n.design.config&&n.design.config.queryParams)for(var d=n.design.config.queryParams,c=0;c<d.length;c++){var p=d[c];if(!p.keyExp||!p.keyExp.trim()||!p.keyExp_isValid||!p.valueExp||!p.valueExp.trim()||!p.valueExp_isValid)return!0}break;case"headers":if(n&&n.design&&n.design.config&&n.design.config.headers)for(var m=n.design.config.headers,u=0;u<m.length;u++){var g=m[u];if(!g.keyExp||!g.keyExp.trim()||!g.keyExp_isValid||!g.valueExp||!g.valueExp.trim()||!g.valueExp_isValid)return!0}break;case"body":var f="none";if(n&&n.design&&n.design.config&&n.design.config.bodyType&&(f=n.design.config.bodyType),"formdata"===f&&n&&n.design&&n.design.config&&n.design.config.formData)for(var h=n.design.config.formData,y=0;y<h.length;y++){var v=h[y];if(v.jsonFormat){if(!v.keyExp||!v.keyExp.trim()||!v.keyExp_isValid||!v.valueJson||!v.valueJson.trim())return!0}else if(!v.keyExp||!v.keyExp.trim()||!v.keyExp_isValid||!v.valueExp||!v.valueExp.trim()||!v.valueExp_isValid)return!0}else if("multipart"===f&&n&&n.design&&n.design.config&&n.design.config.multipart)for(var b=n.design.config.multipart,x=0;x<b.length;x++){var E=b[x];if(E.contents)for(var k=0;k<E.contents.length;k++){var N=E.contents[k];if(N.jsonFormat){if(!N.keyExp||!N.keyExp.trim()||!N.keyExp_isValid||!N.valueJson||!N.valueJson.trim())return!0}else if(!N.keyExp||!N.keyExp.trim()||!N.keyExp_isValid||!N.valueExp||!N.valueExp.trim()||!N.valueExp_isValid)return!0}}else if("urlencoded"===f&&n&&n.design&&n.design.config&&n.design.config.urlEncoded)for(var w=n.design.config.urlEncoded,S=0;S<w.length;S++){var C=w[S];if(C.jsonFormat){if(!C.keyExp||!C.keyExp.trim()||!C.keyExp_isValid||!C.valueJson||!C.valueJson.trim())return!0}else if(!C.keyExp||!C.keyExp.trim()||!C.keyExp_isValid||!C.valueExp||!C.valueExp.trim()||!C.valueExp_isValid)return!0}else if("json"===f&&n&&n.design&&n.design.config&&(!n.design.config.applicationJson||!n.design.config.applicationJson.trim()))return!0;break;default:return!1}return!1}},{key:"isEmpty",value:function(e){for(var a in e)return!1;return!0}},{key:"deleteParam",value:function(e){var a=this.props,t=a.formValues,n=a.change,r=[];t&&t.design&&t.design.params&&(r=t.design.params),n("design.params",r=r.filter((function(a,t){return t!==e})))}},{key:"moveParamDown",value:function(e){var a=this.props,t=a.formValues,n=a.change,i=[];if(t&&t.design&&t.design.params&&(i=Object(r.a)(t.design.params)),e+1===i.length){var s=i[e];i.pop(),i.unshift(s)}else{var o=i[e],l=i[e+1];i[e]=l,i[e+1]=o}n("design.params",i)}},{key:"moveParamUp",value:function(e){var a=this.props,t=a.formValues,n=a.change,i=[];if(t&&t.design&&t.design.params&&(i=Object(r.a)(t.design.params)),0===e){var s=i[e];i.shift(),i.push(s)}else{var o=i[e],l=i[e-1];i[e]=l,i[e-1]=o}n("design.params",i)}},{key:"manageParamDefinition",value:function(e){var a=this.state,t=a.currentParam,n=a.currentParamIndex,i=this.props,s=i.formValues,o=i.change,l=[];if(s&&s.design&&s.design.params&&(l=s.design.params),t&&n>=0)o("design.params",l=l.map((function(a,t){return t===n?e:a})));else{var d=Object(r.a)(l);d.push(e),o("design.params",d)}}},{key:"buildClientModel",value:function(e){var a=this.createModelJson("client",this.getNewId(),e,"sub-model-object"),t=this.creteFieldJson("deviceType",this.getNewId(),"text");a.fields.push(t);var n=this.creteFieldJson("ip",this.getNewId(),"text");return a.fields.push(n),a}},{key:"getParamType",value:function(e){switch(e.type){case"expression":switch(e.paramConfig.returnType){case 1:return"integer";case 2:return"decimal";case 3:return"boolean";case 4:return"text";case 5:return"object";case 6:return"object-list";default:return"text"}case"checkbox":return"boolean";case"radiogroup":case"select":case"edit_email":return"text";case"edit_json":return"object";default:return"text"}}},{key:"getNewId",value:function(){return y()().toHexString()}},{key:"createModelJson",value:function(e,a,t,n){return{_id:this.getNewId(),subType:"input",transient:!0,name:e,iname:a,parentiname:t,type:n,fields:[]}}},{key:"creteFieldJson",value:function(e,a,t){return{_id:this.getNewId(),type:t,transient:!0,name:e,iname:a}}},{key:"validateNodeConfig",value:function(){var e=Object(o.a)(s.a.mark((function e(){var a,t,n,r,i,o,l,d,c,p,m,u,g,f,h,y,v,b,x,E,k,N,w,S,C,T,R,O,I,M,P,j,D,L,A,V,q,_,W;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=this.props,t=a.t,n=a.formValues,r=a.validateMultiExpressionAction,i=a.user,o=a.app,l=a.activeSnap,this.setState({validating:!0}),d=[],(c=this.getDynamicModels()).length>0&&(p=c[0],d.push({name:"this",modeliname:p.iname,lookups:[]})),m=[],u=[],n.design.config.responseObjPath&&n.design.config.responseObjPath.trim()&&m.push({name:"outputs",title:t("Response model path expression"),expStr:n.design.config.responseObjPath}),g=0;g<n.design.params.length;g++)(f=n.design.params[g]).validationRuleExpStr&&f.validationRuleExpStr.trim()&&m.push({name:"params",title:t("%s - Validation rule expression").sprintf(f.name),expStr:f.validationRuleExpStr}),f.validationErrorExpStr&&f.validationErrorExpStr.trim()&&m.push({name:"params",title:t("%s - Error message expression").sprintf(f.name),expStr:f.validationErrorExpStr}),f.defaultValueExpStr&&f.defaultValueExpStr.trim()&&"expression"===f.type&&m.push({name:"params",title:t("%s - Default value expression").sprintf(f.name),expStr:f.defaultValueExpStr});m.push({name:"endpoint_auth",title:t("Endpoint"),expStr:n.design.config.endpoint}),e.t0=n.design.config.authentication,e.next="noauth"===e.t0?13:"apikey"===e.t0?14:"bearer"===e.t0?17:"basic"===e.t0?19:22;break;case 13:return e.abrupt("break",23);case 14:return m.push({name:"endpoint_auth",title:t("API key name expression"),expStr:n.design.config.apiKeyName}),m.push({name:"endpoint_auth",title:t("API key value expression"),expStr:n.design.config.apiKeyValue}),e.abrupt("break",23);case 17:return m.push({name:"endpoint_auth",title:t("Bearer token expression"),expStr:n.design.config.bearerToken}),e.abrupt("break",23);case 19:return m.push({name:"endpoint_auth",title:t("Username expression"),expStr:n.design.config.username}),m.push({name:"endpoint_auth",title:t("Password expression"),expStr:n.design.config.password}),e.abrupt("break",23);case 22:return e.abrupt("break",23);case 23:for(h=0;h<n.design.config.queryParams.length;h++)y=n.design.config.queryParams[h],m.push({name:"query",title:t("Query param #%s key expression").sprintf(h+1),expStr:y.keyExp}),m.push({name:"query",title:t("Query param #%s value expression").sprintf(h+1),expStr:y.valueExp});for(v=0;v<n.design.config.headers.length;v++)b=n.design.config.headers[v],m.push({name:"headers",title:t("Header #%s key expression").sprintf(v+1),expStr:b.keyExp}),m.push({name:"headers",title:t("Header #%s value expression").sprintf(v+1),expStr:b.valueExp});e.t1=n.design.config.bodyType,e.next="none"===e.t1?28:"formdata"===e.t1?29:"multipart"===e.t1?31:"urlencoded"===e.t1?33:"json"===e.t1?35:39;break;case 28:return e.abrupt("break",40);case 29:for(x=0;x<n.design.config.formData.length;x++)if(E=n.design.config.formData[x],m.push({name:"body",title:t("Form data param #%s key expression").sprintf(x+1),expStr:E.keyExp}),E.jsonFormat){for(k=this.getJsonExpressions(E.valueJson),N=0;N<k.length;N++)(w=k[N]).hasExp&&m.push({name:"body",title:t("Form data param #%s JSON document expression").sprintf(x+1)+" "+w.block,expStr:w.expressionStr});u=u.concat(this.validateSyntax("body",t("Form data param #%s JSON document syntax").sprintf(x+1),k))}else m.push({name:"body",title:t("Form data param #%s value expression").sprintf(x+1),expStr:E.valueExp});return e.abrupt("break",40);case 31:for(S=0;S<n.design.config.multipart.length;S++)if((C=n.design.config.multipart[S]).contents)for(T=0;T<C.contents.length;T++)if(R=C.contents[T],m.push({name:"body",title:t("Body part #%s param #%s key expression").sprintf(S+1,T+1),expStr:R.keyExp}),R.jsonFormat){for(O=this.getJsonExpressions(R.valueJson),I=0;I<O.length;I++)(M=O[I]).hasExp&&m.push({name:"body",title:t("Body part #%s param #%s JSON document expression").sprintf(S+1,T+1)+" "+M.block,expStr:M.expressionStr});u=u.concat(this.validateSyntax("body",t("Body part #%s param #%s JSON document syntax").sprintf(S+1,T+1),O))}else m.push({name:"body",title:t("Body part #%s param #%s value expression").sprintf(S+1,T+1),expStr:R.valueExp});return e.abrupt("break",40);case 33:for(P=0;P<n.design.config.urlEncoded.length;P++)if(j=n.design.config.urlEncoded[P],m.push({name:"body",title:t("URL encoded param #%s key expression").sprintf(P+1),expStr:j.keyExp}),j.jsonFormat){for(D=this.getJsonExpressions(j.valueJson),L=0;L<D.length;L++)(A=D[L]).hasExp&&m.push({name:"body",title:t("URL encoded param #%s JSON document expression").sprintf(P+1)+" "+A.block,expStr:A.expressionStr});u=u.concat(this.validateSyntax("body",t("URL encoded param #%s JSON document syntax").sprintf(P+1),D))}else m.push({name:"body",title:t("URL encoded param #%s value expression").sprintf(P+1),expStr:j.valueExp});return e.abrupt("break",40);case 35:for(V=this.getJsonExpressions(n.design.config.applicationJson),q=0;q<V.length;q++)(_=V[q]).hasExp&&m.push({name:"body",title:t("JSON document body expression")+" "+_.block,expStr:_.expressionStr});return u=u.concat(this.validateSyntax("body",t("JSON document body syntax"),V)),e.abrupt("break",40);case 39:return e.abrupt("break",40);case 40:if(!(m.length>0)){e.next=47;break}return e.next=43,r(i._id,i.token,o?o._id:null,l?l._id:null,{expressions:m,context:d,dynamicModels:c||[],ignoreTransient:!0});case 43:200===(W=e.sent).status?this.setState({validating:!1,validationResult:W.data,internalError:null,syntaxErrors:u}):this.setState({internalError:t("An internal error has occured. %s").sprintf(W.data.details),validating:!1,validationResult:null,syntaxErrors:u}),e.next=48;break;case 47:this.setState({validating:!1,validationResult:[],syntaxErrors:u,internalError:null});case 48:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getJsonExpressions",value:function(e){for(var a=[],t=[],n=e.matchAll(/{{\s*[^\r\n\t\f\v{}]*\s*}}/g),r=n.next();!r.done;){var i=r.value[0].match(/[^{{]+(?=}})/g);t.push({block:r.value[0],expression:i?i[0]:"",blockStart:r.value.index,blockEnd:r.value.index+r.value[0].length}),r=n.next()}if(t&&t.length>0)for(var s=0;s<t.length;s++){var o=t[s].expression,l={expressionStr:o=o.trim(),type:"exp",hasExp:!0,block:t[s].block};"/if"===o.toLowerCase()?(l.expressionStr=null,l.type="if-end",l.hasExp=!1):o.toLowerCase().startsWith("#if")&&(l.expressionStr=o.substring(3).trim(),l.type="if-start",l.hasExp=!0),a.push(l)}return a}},{key:"validateSyntax",value:function(e,a,t){for(var n=this.props.t,r=[],i=0;i<t.length;i++){var s=t[i];if("if-start"===s.type)-1===this.getClosingIf(i+1,t)&&r.push({name:e,title:a,expStr:s.expressionStr,success:!1,response:{message:n("If statement %s does not have a closing %s tag").sprintf(s.block,"{{/if}}")}})}return r}},{key:"getClosingIf",value:function(e,a){for(var t=0,n=e;n<a.length;n++){var r=a[n];if("exp"!==r.type)if("if-start"!==r.type){if("if-end"===r.type){if(0===t)return n;t--}}else t++}return-1}},{key:"getInfoCard",value:function(e){var a=this.props,t=a.t,i=a.node;return{name:e.name,group:this.getGroupName(e.groupId),typeId:i?i.design.infoCard.typeId:this.getNewId(),description:e.design.description,multiInput:e.design.multiInput,multiOutput:!1,restrictedInputTypes:e.design.listInputRestricted?["list"]:void 0,errorManagement:!0,inputs:e.design.inputs.map((function(e){return{name:e.name.trim(),iname:e.name.trim(),type:e.type,description:e.description.trim(),modeliname:e.isFile?"file":null,modelname:e.isFile?"file":null}})),outputs:[{name:e.design.output.name.trim(),iname:e.design.output.name.trim(),type:e.design.output.type,description:e.design.output.description.trim(),canChangeType:!1},{name:t("errors"),iname:"errors",type:"list",description:t("Erros occured during node execution."),error:!0,onDemand:!0}],config:[].concat(Object(r.a)(e.design.params.map((function(e){var a={key:e.name.trim(),name:e.title.trim(),required:("expression"!==e.type||!e.defaultValueExpStr||!e.defaultValueExpStr.trim())&&e.required,type:e.type,defaultValue:e.defaultValue,description:e.description.trim()};return"expression"===e.type?a.props={returnFieldType:null,returnType:6===e.paramConfig.returnType?5:e.paramConfig.returnType,returnTypeErrText:null,showFunctions:!0,typeFilter:null,showFavorites:!1,showHeader:!1}:"checkbox"===e.type?a.checkbox={value:!0,label:e.paramConfig.label.trim(),disabled:!1}:"select"===e.type?a.options=e.paramConfig.selectOptions.map((function(e){return{key:e.value,name:e.label}})):"radiogroup"===e.type&&(a.radios=e.paramConfig.radioOptions.map((function(e){return{value:e.value,label:e.label,disabled:!1}}))),a}))),[{key:"errorManagement",name:t("Error management"),required:!0,type:"radiogroup",defaultValue:"auto",radios:[{value:"auto",label:"Automatic error handling",disabled:!1},{value:"manual",label:"Manual error handling",disabled:!1}],description:t("Error handler type of processing errors raised by this node, either automatically or manually.")}]),internal:{paramExps:e.design.params.filter((function(e){return e.validationRuleExpStr&&e.validationErrorExpStr||"expression"===e.type&&e.defaultValueExpStr})).map((function(e){return{key:e.name,name:e.title,validationRuleExpStr:e.validationRuleExpStr,validationErrorExpStr:e.validationErrorExpStr,defaultValueExpStr:e.defaultValueExpStr}})),config:Object(n.a)({outputModelType:e.design.output.modelType,modelDefinition:e.design.output.modelDefinition,outputType:e.design.output.type},e.design.config),paramsModel:this.getDynamicModels()}}}},{key:"getGroupName",value:function(e){var a=this.props.app;if(!a||!a.nodeGroups)return null;for(var t=0;t<a.nodeGroups.length;t++){var n=a.nodeGroups[t];if(n._id===e)return n.name}return null}}]),t}(u.a.PureComponent);be.defaultProps={user:null,app:null,activeSnap:null,systemModels:[],readOnly:!1,node:null,callback:null,isRepoNode:!1};a.a=Object(k.g)(Object(v.b)((function(e,a){var t=a&&a.node?a.node.design.raw:null;return{user:e.user,app:e.app,initialValues:{name:t?t.name:"",groupId:a.node?null===a.node.groupId||a.isRepoNode?-1:a.node.groupId:-1,type:t?t.type:"restapi",marketStatus:t?t.marketStatus:"none",design:t?t.design:{description:"",multiInput:!0,listInputRestricted:!0,inputs:[{name:"input",type:"object",isFile:!1,description:f.a.t("Input object of the node that will be used to configure node properties.")}],output:{name:"output",type:"object",description:f.a.t("Response of the REST API call."),modelType:"custom",modelDefinition:null},params:[],config:{responseObjPath:null,httpMethod:"GET",endpoint:null,authentication:"noauth",apiKeyName:null,apiKeyValue:null,apiKeyAddTo:"header",bearerToken:null,username:null,password:null,queryParams:[],headers:[],bodyType:"none",formData:[],multipart:[],urlEncoded:[],applicationJson:null}}},formValues:Object(U.a)("createRestAPINode")(e),formErrors:Object(K.a)("createRestAPINode")(e)}}),{authAction:ne.a,createAppNodeAction:te.D,updateAppNodeAction:te.mf,validateMultiExpressionAction:te.ag,addNodeToRepoAction:te.l,updateNodeInRepoAction:te.Cf})(Object(H.a)({form:"createRestAPINode",enableReinitialize:!0})(Object(N.a)()(Object(b.a)((function(e){return{dialogPaper:{minHeight:"790px",maxHeight:"790px"},dialogForm:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"stretch",alignContent:"flex-start",flexWrap:"nowrap"},progress:{marginRight:e.spacing(1)},closeButton:{position:"absolute",right:e.spacing(2),padding:e.spacing(.5),color:e.palette.grey[400]},closeButtonIcon:{width:"24px",height:"24px",minWidth:"24px"},dialogContentRoot:{"&:first-child":{paddingTop:e.spacing(1)},display:"flex",flexDirection:"column",flexGrow:1,height:"480px"},errorRow:{flexShrink:0,marginBottom:e.spacing(1)},stepperRow:{flexShrink:0,display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:e.palette.background.layer3},contentRow:{flexGrow:1,overflowY:"auto",overflowX:"hidden",paddingRight:e.spacing(1)},dialogActions:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3),paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},leftAction:{flexGrow:1},padding:{padding:e.spacing(1)},bottomMargin:{marginBottom:e.spacing(2)},topMargin:{marginTop:e.spacing(2)},paddingLeft:{paddingLeft:e.spacing(1)},lrmargin:{margin:e.spacing(0,4,0,3)},ml2:{marginLeft:e.spacing(3)},bold:{fontWeight:500},primary:{color:"light"===e.palette.type?e.palette.primary.main:e.palette.primary.linkForDark},error:{color:e.palette.error.main},success:{color:e.palette.success.main},rounded:{borderRadius:e.spacing(1)},uppercase:{textTransform:"uppercase"},background:{backgroundColor:"light"===e.palette.type?e.palette.primary.bgColor:"transparent"},body2:{fontSize:e.typography.body2.fontSize},icon:{marginRight:e.spacing(.5)},readOnly:{marginLeft:e.spacing(.5)},entry:{display:"flex",alignItems:"center",marginTop:e.spacing(1),padding:e.spacing(.5),backgroundColor:e.palette.action.hover,borderRadius:e.shape.borderRadius},caption:{fontSize:e.typography.caption.fontSize},button:{padding:e.spacing(1),color:"light"===e.palette.type?e.palette.text.secondary:e.palette.primary.linkForDark},buttonIcon:{width:"16px",height:"16px",maxWidth:"16px",maxHeight:"16px"},lastRow:{marginTop:e.spacing(1)},lastRow2:{margin:e.spacing(2,0)},disabledLink:{color:e.palette.text.disabled,cursor:"default",textDecoration:"none","&:hover":{cursor:"default",textDecoration:"none"}},dense:{padding:e.spacing(.5)},contextMenuCell:{padding:0},scrollYAuto:{overflowY:"auto"}}}),{withTheme:!0})(Object(E.a)()(be))))))}}]);