(this["webpackJsonpui-designer"]=this["webpackJsonpui-designer"]||[]).push([[0],{378:function(e,t,n){"use strict";var a=n(11),r=n(12),i=n(13),s=n(14),o=n(5),c=n.n(o),l=n(22),p=n(109),u=n(323),h=n(120),d=n(745),f=n(122),m=n(51),v=n(778),b=n(812),g=n(82),w=n(326),O=n(17),E=n(381),k=n(657),j=n(16),x=n(110),y=function(e){Object(i.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).showNotificationsPanel=function(e){r.setState({anchorEl:e.currentTarget})},r.handleClose=function(){var e=Date.now();Object(j.m)("notificationsLastOpenDtm",e),r.setState({anchorEl:null,lastOpenDtm:e})},r.state={anchorEl:null,lastOpenDtm:Object(j.g)("notificationsLastOpenDtm",null)},r}return Object(r.a)(n,[{key:"render",value:function(){var e=this.state,t=e.anchorEl,n=e.lastOpenDtm,a=this.props,r=a.app,i=a.authAction;return r&&1===i("view-logs",{app:r})?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{onClick:this.showNotificationsPanel},this.renderHeaderButton()),c.a.createElement(k.a,{onClose:this.handleClose,anchorEl:t,lastOpenDtm:n})):null}},{key:"renderHeaderButton",value:function(){var e=this.state.lastOpenDtm,t=this.props,n=t.t,a=t.classes,r=t.theme,i=t.user,s=t.app;if(!i||!s)return null;var o=this.getProcessedMessages(),l=0;return o&&(l=e?o.filter((function(t){return t.timestamp>e})).length:o.length),c.a.createElement(E.a,{title:n("Notifications"),placement:"bottom",enterDelay:O.a.tooltipEnterDelay,enterNextDelay:O.a.tooltipEnterNextDelay},c.a.createElement(v.a,{className:a.button,"aria-label":"Notifications"},c.a.createElement(b.a,{variant:"dot",anchorOrigin:{vertical:"top",horizontal:"right"},style:{color:r.palette.error.main},badgeContent:l,max:O.a.maxNotificationBadgeCount,color:"primary",showZero:!1},c.a.createElement(g.a,{icon:w.l,className:a.icon}))))}},{key:"getProcessedMessages",value:function(){var e=this.props,t=e.user,n=e.notifications;if(!n||0===n.messages.length)return null;var a=[];return t.notificationPreferences&&!t.notificationPreferences.showUser||a.push("User"),t.notificationPreferences&&!t.notificationPreferences.showApp||a.push("Application"),t.notificationPreferences&&!t.notificationPreferences.showSnapshot||a.push("Snapshot"),t.notificationPreferences&&!t.notificationPreferences.showModel||a.push("Model"),t.notificationPreferences&&!t.notificationPreferences.showField||a.push("Field"),t.notificationPreferences&&!t.notificationPreferences.showEnvironment||a.push("Environment"),t.notificationPreferences&&!t.notificationPreferences.showAPIKey||a.push("APIKey"),t.notificationPreferences&&!t.notificationPreferences.showEndpoint||a.push("Endpoint"),t.notificationPreferences&&!t.notificationPreferences.showService||a.push("Service"),t.notificationPreferences&&!t.notificationPreferences.showTask||a.push("Task"),t.notificationPreferences&&!t.notificationPreferences.showQueue||a.push("Queue"),t.notificationPreferences&&!t.notificationPreferences.showFunction||a.push("Function"),n.messages.filter((function(e){return a.includes(e.category)}))}}]),n}(c.a.PureComponent),S=Object(m.b)((function(e){var t=null;return e.notifications&&e.app&&(t=e.notifications.find((function(t){return t.key===e.app._id}))),{user:e.user,app:e.app,notifications:t}}),{authAction:x.a})(Object(l.a)((function(e){var t,n;return{button:(t={padding:e.spacing(1)},Object(f.a)(t,e.breakpoints.down("md"),{width:"36px",height:"36px"}),Object(f.a)(t,e.breakpoints.up("md"),{width:"36px",height:"36px"}),t),icon:(n={},Object(f.a)(n,e.breakpoints.down("md"),{fontSize:"16px"}),Object(f.a)(n,e.breakpoints.up("md"),{fontSize:"16px"}),Object(f.a)(n,"color",e.palette.text.primary),n)}}),{withTheme:!0})(Object(p.a)()(y))),I=n(2),P=n.n(I),A=n(3),D=n(18),T=n(61),N=n(299),C=n(60),R=n(655),z=n(515),M=function(e){Object(i.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).showTasksPanel=function(e){r.setState({anchorEl:e.currentTarget})},r.handleClose=function(){r.setState({anchorEl:null})},r.refreshEnvsStatus=Object(A.a)(P.a.mark((function e(){var t,n,a,i;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.props,n=t.user,a=t.app,i=t.getEnvsStatusAction,r.setState({refreshingStatus:!0}),e.next=4,i(n._id,n.token,a._id);case 4:200===e.sent.status?r.setState({refreshDtm:Date.now(),refreshingStatus:!1}):r.setState({refreshingStatus:!1});case 6:case"end":return e.stop()}}),e)}))),r.refreshId=null,r.state={anchorEl:null,refreshingStatus:!1,refreshDtm:null},r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=Object(A.a)(P.a.mark((function e(){var t,n,a,r,i,s,o,c,l,p,u,h,d,f;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,n=this.props,a=n.t,r=n.user,i=n.app,s=n.envs,o=n.getAppAction,c=n.getEnvsAction,l=n.match,p=n.authAction,u=n.getCodeFunctionsAction,h=n.codeFunctions,d=i||null,f=h||null,l.params.appId){e.next=6;break}return e.abrupt("return");case 6:if(d||!r){e.next=16;break}return e.next=9,o(l.params.userId,r.token,l.params.appId);case 9:if(200===(t=e.sent).status){e.next=15;break}return this.setState({errorTitle:a("An error has occured while loading the application!"),errorMessage:t.data.details}),e.abrupt("return");case 15:d=t.data;case 16:if(0!==p("view-envs",{app:d})){e.next=18;break}return e.abrupt("return");case 18:if(s||!r||!d){e.next=25;break}return e.next=21,c(l.params.userId,r.token,l.params.appId);case 21:if(200===(t=e.sent).status){e.next=25;break}return this.setState({errorTitle:a("An error has occured while loading environments!"),errorMessage:t.data.details}),e.abrupt("return");case 25:if(f||!r||!d){e.next=35;break}return e.next=28,u(l.params.userId,r.token,l.params.appId);case 28:if(200===(t=e.sent).status){e.next=34;break}return this.setState({errorTitle:a("An error has occured while loading full-code services!"),errorMessage:t.data.details}),e.abrupt("return");case 34:f=t.data;case 35:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.refreshId&&clearInterval(this.refreshId)}},{key:"render",value:function(){var e=this.state.anchorEl,t=this.props,n=t.app,a=t.authAction,r=t.envs,i=t.codeFunctions;return n&&r&&i&&0!==a("view-envs",{app:n})?(0===r.length&&this.refreshId&&(clearInterval(this.refreshId),this.refreshId=null),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{onClick:this.showTasksPanel},this.renderHeaderButton()),e&&c.a.createElement(R.a,{onClose:this.handleClose,anchorEl:e}))):null}},{key:"renderHeaderButton",value:function(){var e=this.props,t=e.t,n=e.classes,a=e.envs,r=e.authAction,i=e.app,s=e.codeFunctions,o=a.filter((function(e){return"deploying"===e.status||"redeploying"===e.status||"undeploying"===e.status||"switching"===e.status})),l=!1;o.length>0&&(l=!0);var p="green",u=!1;if(l)this.refreshId||(this.refreshId=setInterval(this.refreshEnvsStatus,O.a.envStatusRefreshPeriod));else{this.refreshId&&(clearInterval(this.refreshId),this.refreshId=null);for(var h=0;h<a.length;h++){var d=a[h];if("error-deploy"===d.status||"error-redeploy"===d.status||"error-undeploy"===d.status||"error-switch"===d.status){p="red";break}"running"===d.status&&(u=!0)}}if("green"===p&&!1===u&&(p="blue"),o.length>0)return c.a.createElement(E.a,{title:t("Environments"),placement:"bottom",enterDelay:O.a.tooltipEnterDelay,enterNextDelay:O.a.tooltipEnterNextDelay},c.a.createElement("div",{className:n.tasksCircle},c.a.createElement("span",null,o.length),c.a.createElement(N.a,{size:36,color:"primary",className:n.spinner})));if(1===r("view-functions",{app:i})&&"red"!==p){for(var f=0,m=0,v=0;v<s.length;v++)for(var b=s[v],g=0;g<b.deployments.length;g++){var w=b.deployments[g];"error"===w.status?f++:"running"!==w.status&&m++}m&&(p="orange"),f&&(p="red")}return c.a.createElement(E.a,{title:t("Environments"),placement:"bottom",enterDelay:O.a.tooltipEnterDelay,enterNextDelay:O.a.tooltipEnterNextDelay},this.renderTaskButton(p))}},{key:"renderTaskButton",value:function(e){var t=this.props.classes;return"green"===e?c.a.createElement(v.a,{className:t.button,"aria-label":"Tasks"},c.a.createElement(z.a,{overlap:"circular",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"dot"},c.a.createElement(g.a,{icon:w.z,className:Object(D.default)(t.icon,"tour-test")}))):"red"===e?c.a.createElement(v.a,{className:t.button,"aria-label":"Tasks"},c.a.createElement(z.c,{overlap:"circular",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"dot"},c.a.createElement(g.a,{icon:w.z,className:Object(D.default)(t.icon,"tour-test")}))):"orange"===e?c.a.createElement(v.a,{className:t.button,"aria-label":"Tasks"},c.a.createElement(z.b,{overlap:"circular",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"dot"},c.a.createElement(g.a,{icon:w.z,className:Object(D.default)(t.icon,"tour-test")}))):c.a.createElement(v.a,{className:t.button,"aria-label":"Tasks"},c.a.createElement(g.a,{icon:w.z,className:Object(D.default)(t.icon,"tour-test")}))}}]),n}(c.a.PureComponent),_=Object(T.g)(Object(m.b)((function(e){return{user:e.user,app:e.app,envs:e.envs,codeFunctions:e.codeFunctions}}),{getAppAction:C.fc,authAction:x.a,getEnvsAction:C.Mc,getEnvsStatusAction:C.Oc,getCodeFunctionsAction:C.xc})(Object(u.a)()(Object(l.a)((function(e){var t,n,a;return{button:(t={padding:e.spacing(1)},Object(f.a)(t,e.breakpoints.down("md"),{width:"36px",height:"36px"}),Object(f.a)(t,e.breakpoints.up("md"),{width:"36px",height:"36px"}),t),icon:(n={},Object(f.a)(n,e.breakpoints.down("md"),{fontSize:"16px"}),Object(f.a)(n,e.breakpoints.up("md"),{fontSize:"16px"}),Object(f.a)(n,"color",e.palette.text.primary),n),tasksCircle:(a={position:"relative",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:e.palette.background.paper,color:e.palette.text.primary,cursor:"pointer"},Object(f.a)(a,e.breakpoints.down("md"),{fontSize:e.typography.caption.fontSize,fontWeight:500,width:"36px",height:"36px",borderRadius:"18px"}),Object(f.a)(a,e.breakpoints.up("md"),{fontSize:e.typography.body2.fontSize,fontWeight:500,width:"36px",height:"36px",borderRadius:"18px"}),Object(f.a)(a,"marginRight",e.spacing(1)),a),spinner:{position:"absolute",left:"0"}}}),{withTheme:!0})(Object(p.a)()(M))))),F=n(582),H=n(658),L=function(){self.addEventListener("message",(function(e){if(e){var t="demo"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_TYPE?"https://api.altogicdev.com":"https://api.altogic.com",n=new XMLHttpRequest;n.open("POST","".concat(t,"/users/").concat(e.data.userId,"/apps/").concat(e.data.appId,"/snaps/").concat(e.data.snapId,"/validate-app"),!0),n.setRequestHeader("Authorization",e.data.token),n.setRequestHeader("Content-Type","application/json"),n.onload=function(e){var t={status:n.status,data:JSON.parse(n.responseText)};postMessage(t)},n.onerror=function(e){var t={status:500,data:n.responseText?JSON.parse(n.responseText):{}};postMessage(t)},n.send(JSON.stringify(e.data))}}))},W=Object(r.a)((function e(t){Object(a.a)(this,e);var n=t.toString(),r=new Blob(["("+n+")()"]);return new Worker(URL.createObjectURL(r))})),B=function(e){Object(i.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).validateApp=function(){if(!r._unmounted){var e=r.state.validating,t=r.props,n=t.user,a=t.app,i=t.activeSnap,s=t.validationResults;n&&i&&a&&!1===e&&(r.setState({validating:!0,showSpinner:!1}),r.worker.postMessage({userId:n._id,token:n.token,appId:a._id,snapId:i._id,validatedAt:s?s.validatedAt:null}),r.spinnerTimerId=setTimeout((function(){!1===r._unmounted&&e&&r.setState({showSpinner:!0})}),null!==r.props.spinnerMinimumDelayMs?r.props.spinnerMinimumDelayMs:O.a.spinnerMinimumDelayMs))}},r.validateAppResponse=function(e){var t=r.props.setAppValidationResults,n=e.data;r.spinnerTimerId&&(clearTimeout(r.spinnerTimerId),r.spinnerTimerId=null),200===n.status?(r.setState({showSpinner:!1,validating:!1}),n.data&&"no-need"!==n.data.status&&t(n.data)):r.setState({showSpinner:!1,validating:!1})},r.spinnerTimerId=null,r._unmounted=!1,r.timer=null,r.worker=null,r.state={showSpinner:!1,validating:!1,anchorEl:null},r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=Object(A.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.timer=setInterval(this.validateApp,O.a.validateAppInterval),this.worker=new W(L),this.worker.addEventListener("message",this.validateAppResponse);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.timer&&clearInterval(this.timer),this.worker&&(this.worker.removeEventListener("message",this.validateAppResponse),this.worker.terminate()),this._unmounted=!0}},{key:"render",value:function(){var e=this,t=this.state,n=t.validating,a=t.showSpinner,r=this.props,i=r.classes,s=r.t,o=r.user,l=r.app,p=r.activeSnap,u=r.authActionGroup,h=r.validationResults;if(!o||!p||!l)return null;var d=u(["view-snapshot","view-services","view-tasks","view-queues","view-endpoints"],{app:l,snap:p,activeSnap:p});return 1!==d["view-snapshot"]||1!==d["view-services"]||1!==d["view-tasks"]||1!==d["view-queues"]||1!==d["view-endpoints"]?null:c.a.createElement(c.a.Fragment,null,c.a.createElement(E.a,{title:s("App validation results"),placement:"bottom",enterDelay:O.a.tooltipEnterDelay,enterNextDelay:O.a.tooltipEnterNextDelay},c.a.createElement(v.a,{className:i.button,onClick:function(t){return e.setState({anchorEl:t.currentTarget})}},c.a.createElement(g.a,{icon:this.getIcon(),className:Object(D.default)(i.icon,this.getIconClass()),spin:n&&a}),h&&h.errorsCount>0&&c.a.createElement("span",{className:i.badge},h.errorsCount))),this.renderValidationResults())}},{key:"renderValidationResults",value:function(){var e=this,t=this.state.anchorEl;return t?c.a.createElement(H.a,{onClose:function(){e.setState({anchorEl:null})},anchorEl:t}):null}},{key:"getIcon",value:function(){var e=this.state,t=e.validating,n=e.showSpinner,a=this.props.validationResults;return t&&n?w.Nb:a?0===a.errorsCount?w.v:w.O:w.Nb}},{key:"getIconClass",value:function(){var e=this.state,t=e.validating,n=e.showSpinner,a=this.props,r=a.classes,i=a.validationResults;return t&&n?null:i?0===i.errorsCount?r.success:r.error:null}}]),n}(c.a.PureComponent),U=Object(m.b)((function(e){return{user:e.user,app:e.app,activeSnap:e.activeSnap,validationResults:e.validationResults}}),{authActionGroup:x.b,setAppValidationResults:C.Oe})(Object(l.a)((function(e){var t,n;return{button:(t={padding:e.spacing(1)},Object(f.a)(t,e.breakpoints.down("md"),{width:"36px",height:"36px"}),Object(f.a)(t,e.breakpoints.up("md"),{width:"36px",height:"36px"}),t),icon:(n={},Object(f.a)(n,e.breakpoints.down("md"),{fontSize:"16px"}),Object(f.a)(n,e.breakpoints.up("md"),{fontSize:"16px"}),Object(f.a)(n,"color",e.palette.text.primary),n),success:{color:e.palette.success.main},error:{color:e.palette.error.main},badge:{display:"inline-block",position:"absolute",fontSize:"0.65rem",top:0,left:e.spacing(2.5),color:e.palette.error.main,backgroundColor:"light"===e.palette.type?"#ffeeee":e.palette.background.layer2,borderRadius:10,minWidth:e.spacing(2),padding:e.spacing(.25),lineHeight:"12px"}}}),{withTheme:!0})(Object(p.a)()(B))),q=n(357),J=function(e){Object(i.a)(n,e);var t=Object(s.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.t,a=e.authAction,r=e.app,i=e.activeSnap,s=e.showSearch,o=e.models;return r&&i&&o&&1===a("view-snapshot",{app:r,snap:i,activeSnap:i})?c.a.createElement(E.a,{title:n("App search"),placement:"bottom",enterDelay:O.a.tooltipEnterDelay,enterNextDelay:O.a.tooltipEnterNextDelay},c.a.createElement(v.a,{className:t.button,onClick:function(e){return s(e.currentTarget)}},c.a.createElement(g.a,{icon:w.Gb,className:t.icon}))):null}}]),n}(c.a.PureComponent),K=Object(m.b)((function(e){return{user:e.user,app:e.app,activeSnap:e.activeSnap,models:e.models}}),{authAction:x.a,showSearch:q.p})(Object(T.g)(Object(l.a)((function(e){var t,n;return{button:(t={padding:e.spacing(1)},Object(f.a)(t,e.breakpoints.down("md"),{width:"36px",height:"36px"}),Object(f.a)(t,e.breakpoints.up("md"),{width:"36px",height:"36px"}),t),icon:(n={},Object(f.a)(n,e.breakpoints.down("md"),{fontSize:"16px"}),Object(f.a)(n,e.breakpoints.up("md"),{fontSize:"16px"}),Object(f.a)(n,"color",e.palette.text.primary),n)}}),{withTheme:!0})(Object(p.a)()(J)))),V=function(e){Object(i.a)(n,e);var t=Object(s.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.width;return c.a.createElement(h.a,{className:t.container},c.a.createElement(K,null),c.a.createElement(d.a,{xsDown:!0},c.a.createElement(U,null),c.a.createElement(S,null),c.a.createElement(_,null)),("xs"===n||"sm"===n)&&c.a.createElement(F.a,null))}}]),n}(c.a.PureComponent);t.a=Object(u.a)()(Object(l.a)((function(e){return{container:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",flexWrap:"nowrap",overflow:"hidden",padding:e.spacing(1,0,1,0)}}}),{withTheme:!0})(Object(p.a)()(V)))}}]);