(this["webpackJsonpui-designer"]=this["webpackJsonpui-designer"]||[]).push([[7],{335:function(e,t,n){"use strict";var a=n(11),i=n(12),l=n(13),r=n(14),o=n(5),s=n.n(o),c=n(22),d=n(109),u=n(120),p=function(e){Object(l.a)(n,e);var t=Object(r.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.children;return e.centered?s.a.createElement(u.a,{className:t.centeredContainer},n):s.a.createElement(u.a,{className:t.container},n)}}]),n}(s.a.PureComponent);p.defaultProps={centered:!1},t.a=Object(c.a)((function(e){return{container:{overflowY:"auto",overflowX:"hidden",flexGrow:1,display:"flex",flexDirection:"column",padding:e.spacing(0,1)},centeredContainer:{flexGrow:1,display:"flex",flexDirection:"row",alignItems:"stretch",justifyContent:"flex-start",overflowY:"auto",overflowX:"hidden"}}}),{withTheme:!0})(Object(d.a)()(p))},550:function(e,t,n){"use strict";var a=n(2),i=n.n(a),l=n(3),r=n(11),o=n(12),s=n(13),c=n(14),d=n(5),u=n.n(d),p=n(51),m=n(22),f=n(109),h=n(555),y=n(778),g=n(635),v=n(299),b=n(82),x=n(326),E=n(17),j=n(330),k=n(60),S=n(508),T=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).onExpChange=function(e,t,n,r,o,s){var c=a.props,d=c.t,p=c.theme,m=c.validateExpressionAction,f=c.user,h=c.app,y=c.activeSnap,g=c.dynamicModels,j=c.required,k=c.ignoreTransient,S=c.modelsContext,T=c.compName,C=c.change,O=c.checkdbQuery,w=c.useContextAsItIs,M=a.state[t];if(M&&clearTimeout(M),null===e.target.value||void 0===e.target.value||""===e.target.value.toString().trim()){var N={};return j?(N[n]=!1,N[o]="error",N[r]=u.a.createElement(u.a.Fragment,null,u.a.createElement(b.a,{icon:x.N,style:{marginRight:p.spacing(.5)}}),u.a.createElement("span",null,d("Required field cannot be left empty")))):(N[n]=!1,N[o]="pending",N[r]=null),void(!1===a._unmounted&&a.setState(N))}var L=setTimeout(Object(l.a)(i.a.mark((function t(){var l,c,E,M,N,L,_,F;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((l={})[n]=!0,l[r]=u.a.createElement(u.a.Fragment,null,u.a.createElement(v.a,{size:12,thickness:4,style:{position:"relative",top:"2px",marginRight:"4px"}}),u.a.createElement("span",{style:{color:"light"===p.palette.type?p.palette.primary.main:p.palette.primary.linkForDark}},d("Validating expression..."))),!1===a._unmounted&&a.setState(l),c=S,c=w?S.filter((function(e){return e.model})).map((function(e){return{name:e.context,modeliname:e.model.iname,lookups:e.lookups}})):S.filter((function(e){return e.model})).map((function(e){return{name:"this",modeliname:e.model.iname,lookups:e.lookups}})),null!==e.target.value&&void 0!==e.target.value&&""!==e.target.value.toString().trim()){t.next=11;break}return E={},j||(E[n]=!1,E[o]="pending",E[r]=null),!1===a._unmounted&&a.setState(E),t.abrupt("return");case 11:return t.next=13,m(f._id,f.token,h?h._id:null,y?y._id:null,{expression:e.target.value,context:c,dynamicModels:g||[],ignoreTransient:k,checkdbQuery:O});case 13:200===(M=t.sent).status?(N=s(M.data))?((L={})[n]=!1,L[o]="error",L[r]=u.a.createElement(u.a.Fragment,null,u.a.createElement(b.a,{icon:x.N,style:{marginRight:p.spacing(.5)}}),u.a.createElement("span",null,N)),C(T+"_isValid",!1),!1===a._unmounted&&a.setState(L)):((_={})[n]=!1,_[o]="success",_[r]=u.a.createElement(u.a.Fragment,null,u.a.createElement(b.a,{icon:x.v,style:{marginRight:p.spacing(.5),color:p.palette.success.dark}}),u.a.createElement("span",{style:{color:p.palette.success.dark}},d("Valid expression"))),C(T+"_isValid",!0),!1===a._unmounted&&a.setState(_)):((F={})[n]=!1,F[o]="error",F[r]=u.a.createElement(u.a.Fragment,null,u.a.createElement(b.a,{icon:x.N,style:{marginRight:p.spacing(.5)}}),u.a.createElement("span",null,M.reduxForm.expression)),C(T+"_isValid",!1),!1===a._unmounted&&a.setState(F));case 15:case"end":return t.stop()}}),t)}))),E.a.throttleDuration),_={};_[t]=L,!1===a._unmounted&&a.setState(_)},a.validateExpression=function(e){var t=a.props,n=t.t,i=t.isPrimitivesArray,l=t.arrayValueType,r=t.compLabel,o=null;return(o=!1===Array.isArray(a.props.returnType)?[a.props.returnType]:a.props.returnType).includes(e.returnType)?i&&!1===e.isPrimitivesArray?n('"%s" expression should return a value of type "%s". Current expression returns "%s" type value.').sprintf(r,a.getReturnTypeText(o),a.getReturnTypeText(e.returnType)):i&&e.isPrimitivesArray&&l!==e.arrayValueType?n('"%s" expression should return a list of "%s" type value. Current expression returns list of "%s" type value.').sprintf(r,a.getReturnTypeText(l),a.getReturnTypeText(e.arrayValueType)):void 0:n('"%s" expression should return a value of type "%s". Current expression returns "%s" type value.').sprintf(r,a.getReturnTypeText(o),a.getReturnTypeText(e.returnType))},a.showExp=function(){!1===a._unmounted&&a.setState({openExpDialog:!0})},a.hideExp=function(){!1===a._unmounted&&a.setState({openExpDialog:!1})},a._unmounted=!1,a.state={validating:!1,validateStatus:"pending",validateMsg:null,validateTimerId:null,openExpDialog:!1},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.expStr,n=e.getThis;t&&this.onExpChange({target:{value:t}},"validateTimerId","validating","validateMsg","validateStatus",this.validateExpression),n&&n(this)}},{key:"refreshValidation",value:function(){var e=this,t=this.props.expStr;setTimeout((function(){return e.onExpChange({target:{value:t}},"validateTimerId","validating","validateMsg","validateStatus",e.validateExpression)}),50)}},{key:"refreshValidate",value:function(e){var t=this;e&&setTimeout((function(){return t.onExpChange({target:{value:e}},"validateTimerId","validating","validateMsg","validateStatus",t.validateExpression)}),E.a.throttleDurationNodeProps)}},{key:"componentWillUnmount",value:function(){this._unmounted=!0}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,a=t.theme,i=t.classes,l=t.readOnly,r=t.width,o=t.multiline,s=t.rows,c=t.compName,d=t.compLabel,p=t.required,m=this.state,f=m.validating,v=m.validateStatus,E=m.validateMsg,k=m.openExpDialog;return u.a.createElement(u.a.Fragment,null,u.a.createElement(h.a,{color:"dark"===a.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,required:p,name:c,label:d,component:j.g,autoComplete:"off",multiline:o,rows:s,disabled:l,helperText:n("Click on f(x) to launch expression editor."),onChange:function(t){return e.onExpChange(t,"validateTimerId","validating","validateMsg","validateStatus",e.validateExpression)},onBlur:function(t){t.target.value&&!t.target.value.trim()||e.onExpChange(t,"validateTimerId","validating","validateMsg","validateStatus",e.validateExpression)},asyncValidate:f,asyncValidateStatus:v,asyncValidateMsg:E,inputProps:{style:{marginTop:0,borderLeftColor:a.palette.divider,borderLeftWidth:o?"1px":0,borderLeftStyle:"solid",paddingLeft:a.spacing(1),fontSize:"xs"===r||"sm"===r?a.typography.body1.fontSize:a.typography.caption.fontSize,fontFamily:'"Lucida Console", Monaco, "Courier New"'},spellCheck:"false",autoComplete:"off",type:"search"},InputProps:{startAdornment:u.a.createElement(g.a,{position:"start",style:{marginTop:o?0:a.spacing(2)}},u.a.createElement(y.a,{color:"primary",className:i.expressionButton,disabled:l,onClick:this.showExp},u.a.createElement(b.a,{icon:x.X,className:i.expression,fixedWidth:!0})))}}),k&&this.renderExpressionDialog())}},{key:"renderExpressionDialog",value:function(){var e=this,t=this.props,n=t.change,a=t.expStr,i=t.models,l=t.systemModels,r=t.dynamicModels,o=t.modelsContext,s=t.required,c=t.compName,d=t.showFunctions,p=t.typeFilter,m=t.showFavorites,f=t.showHeader,h=t.ignoreTransient,y=t.activeSnap,g=t.checkdbQuery,v=this.state.openExpDialog,b=i.concat(l).concat(r);return u.a.createElement(S.a,{fullWidth:!0,maxWidth:"sm",open:v,handleClose:this.hideExp,callBack:function(t){n(c,t.externalExpStr),e.onExpChange({target:{value:t.externalExpStr}},"validateTimerId","validating","validateMsg","validateStatus",e.validateExpression)},models:o,fullList:b,dynamicModels:r,validate:this.validateExpression,expression:a,showFunctions:d,typeFilter:p,showFavorites:m,showHeader:f,required:s,ignoreTransient:h,activeSnap:y,checkdbQuery:g})}},{key:"getReturnTypeText",value:function(e){var t=this.props.t,n=e;if(!1===Array.isArray(e)&&(n=[e]),n.length>1){for(var a=[],i=0;i<n.length-1;i++){var l=n[i];a.push(this.getTypeText(l))}return a.join(", ")+(2===n.length?t(" or "):t(", or "))+this.getTypeText(n[n.length-1])}for(var r=[],o=0;o<n.length;o++){var s=n[o];r.push(this.getTypeText(s))}return r.join(", ")}},{key:"getTypeText",value:function(e){var t=this.props.t;switch(e){case 1:return t("integer");case 2:return t("decimal");case 3:return t("boolean");case 4:return t("text");case 5:return t("object");default:return t("none")}}}]),n}(u.a.PureComponent);T.defaultProps={readOnly:!1,width:null,user:null,app:null,activeSnap:null,change:null,models:[],systemModels:[],dynamicModels:[],modelsContext:[],required:!1,expStr:null,multiline:!0,rows:4,compName:null,compLabel:null,showFunctions:!0,typeFilter:null,showFavorites:!1,showHeader:!1,ignoreTransient:!0,isPrimitivesArray:null,arrayValueType:null,returnType:4,checkdbQuery:!1,useContextAsItIs:!1,getThis:null},t.a=Object(p.b)(null,{validateExpressionAction:k.Zf})(Object(m.a)((function(e){return{expressionButton:{padding:e.spacing(.5),color:"light"===e.palette.type?e.palette.primary.main:e.palette.primary.linkForDark},expression:{width:"24px",height:"24px",minWidth:"24px",fontSize:e.typography.body2.fontSize}}}),{withTheme:!0})(Object(f.a)()(T)))},551:function(e,t,n){"use strict";var a=n(11),i=n(12),l=n(13),r=n(14),o=n(5),s=n.n(o),c=n(22),d=n(109),u=n(323),p=n(570),m=n.n(p),f=(n(572),n(615),n(616),n(573),n(574),n(617)),h=n(796),y=n(805),g=n(799),v=n(800),b=n(298),x=n(778),E=n(80),j=n(671),k=n(82),S=n(328),T=n(81),C=n(508),O=function(e){Object(l.a)(n,e);var t=Object(r.a)(n);function n(e){var i;return Object(a.a)(this,n),(i=t.call(this,e)).onResizeEditor=function(e,t){i.setState({editorH:t,editorW:e})},i.validateExpression=function(e){var t=i.props,n=t.t;if("text"===t.type&&(5===e.returnType||-1===e.returnType))return n('Expression should return a value of type "integer, decimal, boolean or text". Current expression returns "%s" type value.').sprintf(5===e.returnType?n("object"):n("none"))},i.showExp=function(){i.setState({openExpDialog:!0})},i.hideExp=function(){i.setState({openExpDialog:!1})},i.handleChange=function(e){var t=i.state.pasted,n=i.props.type;if(t&&"json"===n)try{var a=JSON.parse(e);return void i.setState({contents:JSON.stringify(a,null,2),pasted:!1})}catch(l){}i.setState({contents:e,pasted:!1})},i.addExpression=function(e){i.editor.editor.session.replace(i.editor.editor.selection.getRange(),"{{"+e+"}}")},i.onClose=function(){(0,i.props.handleClose)()},i.toggleFullScreen=function(){var e=i.state.fullscreen;i.setState({fullscreen:!e})},i.onSubmit=function(){var e=i.state.contents,t=i.props,n=t.handleClose,a=t.callback;a&&a(e),n()},i.processPaste=function(){i.setState({pasted:!0})},i.editor=null,i.state={contents:e.contents,openExpDialog:!1,pasted:!1,fullscreen:!1,editorH:"100",editorW:"100"},i}return Object(i.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this,t=this.state,n=t.contents,a=t.openExpDialog,i=t.fullscreen,l=t.editorH,r=t.editorW,o=this.props,c=o.classes,d=o.t,u=o.theme,p=o.open,O=o.handleClose,w=o.fullWidth,M=o.maxWidth,N=o.width,L=o.title,_=o.models,F=o.fullList,V=o.dynamicModels,z=o.showFunctions,W=o.typeFilter,A=o.showFavorites,D=o.showHeader,I=o.required,P=o.ignoreTransient,B=o.type,R=o.activeSnap,H=i;return"xs"===N&&(H=!0),s.a.createElement(h.a,{fullWidth:w,maxWidth:M,fullScreen:H,open:p,onClose:function(e,t){if("backdropClick"===t)return!1;O()},"aria-labelledby":"edit-text-dialog",classes:{paper:"xs"===N||!0===H?null:c.dialogPaper}},s.a.createElement(y.a,{id:"edit-text-dialog"},s.a.createElement("div",{style:{display:"flex",alignItems:"center"}},s.a.createElement("div",{style:{flexGrow:1}},s.a.createElement(E.a,{component:"span",variant:"h6"},L||d("text"===B?"Edit text message":"html"===B?"Edit HTML document":"Edit JSON document"))),s.a.createElement("div",{style:{flexShrink:0}},s.a.createElement(x.a,{"aria-label":"fullscreen",onClick:this.toggleFullScreen},s.a.createElement(k.a,{icon:H?S.i:S.m,className:c.expandButtonIcon})),s.a.createElement(x.a,{"aria-label":"close",onClick:this.onClose},s.a.createElement(k.a,{icon:S.x,className:c.closeButtonIcon}))))),s.a.createElement(g.a,{classes:{root:c.dialogContentRoot},style:{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"hidden"}},s.a.createElement("div",{className:c.bottomMargin},s.a.createElement(j.a,{severity:"info",icon:!1},d("Position the cursor to the location where you would like to add an expression and click on Add Expression to launch expression editor and insert dynamic values."))),s.a.createElement("div",{style:{flexGrow:1,minWidth:0,minHeight:0}},s.a.createElement(f.a,{handleWidth:!0,handleHeight:!0,onResize:this.onResizeEditor}),s.a.createElement(m.a,{mode:"text"===B?"handlebars":"html"===B?"html":"json",theme:"light"===u.palette.type?"xcode":"monokai",name:"content",width:"".concat(r,"px"),height:"".concat(l,"px"),fontSize:13,showPrintMargin:!1,showGutter:!0,highlightActiveLine:!0,value:null===n?"":n,readOnly:!1,setOptions:{showLineNumbers:!0,tabSize:2,fontFamily:"monospace"},onChange:this.handleChange,onPaste:this.processPaste,ref:function(t){return e.editor=t}}))),s.a.createElement(v.a,{className:c.dialogActions},s.a.createElement("div",{className:c.addExp},s.a.createElement(b.a,{type:"submit",variant:"contained",disableElevation:!0,color:"primary",onClick:this.showExp},s.a.createElement(k.a,{icon:T.Ib,fixedWidth:!0,style:{marginRight:u.spacing(1)}}),d("Add expression"))),s.a.createElement(b.a,{type:"submit",variant:"contained",disableElevation:!0,color:"primary",onClick:this.onSubmit},d("OK")),s.a.createElement(b.a,{variant:"contained",disableElevation:!0,onClick:this.onClose},d("Cancel"))),a&&s.a.createElement(C.a,{fullWidth:!0,maxWidth:"sm",open:a,handleClose:this.hideExp,callBack:function(t){e.addExpression(t.externalExpStr)},models:_,fullList:F,dynamicModels:V,validate:this.validateExpression,expression:null,showFunctions:z,typeFilter:W,showFavorites:A,showHeader:D,required:I,ignoreTransient:P,activeSnap:R}))}}]),n}(s.a.PureComponent);O.defaultProps={models:null,fullList:null,dynamicModels:null,handleClose:null,callback:null,showFunctions:!0,typeFilter:null,showFavorites:!1,showHeader:!1,required:!1,ignoreTransient:!0,contents:"",title:null,type:"text",activeSnap:null},t.a=Object(u.a)()(Object(c.a)((function(e){return{dialogPaper:{minHeight:"705px",maxHeight:"705px"},closeButton:{position:"absolute",right:e.spacing(2),padding:e.spacing(.5),color:e.palette.grey[400]},expandButtonIcon:{width:"20px",height:"20px",minWidth:"20px"},closeButtonIcon:{width:"24px",height:"24px",minWidth:"24px"},dialogContentRoot:{"&:first-child":{paddingTop:8}},dialogActions:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3),paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},addExp:{flexGrow:1},bottomMargin:{marginBottom:e.spacing(2)}}}),{withTheme:!0})(Object(d.a)()(O)))},667:function(e,t,n){"use strict";var a=n(4),i=n(15),l=n(11),r=n(12),o=n(13),s=n(14),c=n(5),d=n.n(c),u=n(18),p=n(395),m=n.n(p),f=n(22),h=n(109),y=n(323),g=n(421),v=n.n(g),b=n(438),x=n.n(b),E=n(439),j=n.n(E),k=n(424),S=n.n(k),T=n(436),C=n.n(T),O=n(437),w=n.n(O),M=n(570),N=n.n(M),L=(n(572),n(615),n(616),n(573),n(574),n(796)),_=n(805),F=n(799),V=n(800),z=n(298),W=n(778),A=n(80),D=n(559),I=n(807),P=n(811),B=n(810),R=n(808),H=n(809),J=n(561),q=n(499),G=n(745),Q=n(804),U=n(671),X=n(82),Y=n(328),K=n(81),Z=n(326),$=n(366),ee=n(351),te=n(392),ne=n(368),ae=n(17),ie=n(330),le=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var r;Object(l.a)(this,n),(r=t.call(this,e)).handleJsonChange=function(e){var t=r.props.t,n=r.state.jsonPasted,a=null,i=null;if(e&&""!==e.trim()){try{a=JSON.parse(e),Array.isArray(a)?(a=null,i=t("Model definition requires a single JSON object not an arrray of objects.")):i=null}catch(l){l.body=e,a=null,i=r.getJsonErrorMessage(l)}r.setState({jsonText:null===i&&a&&n?JSON.stringify(a,null,2):e,json:a,jsonError:i,jsonPasted:!1})}else r.setState({jsonText:"",json:null,jsonError:null,jsonPasted:!1})},r.convertJsonToModel=function(){var e=r.state,t=e.json,n=e.oldModelName,a=[],i=[],l=r.createModelJson(n||"outputModel",r.getNewId(),null,"model");r.buildModel(a,i,l,t),r.setState({modelName:n||"outputModel",currentModels:i,normalizedList:a,step:"confirm"})},r.getJsonErrorMessage=function(e){var t=e.message,n=t.lastIndexOf("position");if(-1!==n){var a=t.substring(n+"position".length).trim(),i=parseInt(a);if(!1===Number.isNaN(i)){for(var l=1,r=e.body.indexOf("\n"),o=0;r<=i&&-1!==r;)l++,o=r,r=e.body.indexOf("\n",r+1);var s=t.substring(0,n-3)+"near line "+l.toString()+" position "+(i-o).toString();t=s}}return t},r.onClose=function(){(0,r.props.handleClose)()},r.onSubmit=function(){var e=r.state,t=e.currentModels,n=e.modelName,l=r.props,o=l.handleClose,s=l.callback,c=Object(i.a)(t),d=r.validateName(n);d?r.setState({modelNameError:d}):(c[0]=Object(a.a)({},c[0]),c[0].name=n,s&&s(c),o())},r.hideTypeSelectMenu=function(){r.setState({selectedEntry:null,anchorEl:null})},r.onModelNameChange=function(e){var t=e.target.value.trim();r.setState({modelName:t,modelNameError:r.validateName(t)})},r.validateName=function(e){var t=r.state,n=t.currentModels,a=t.oldModelName,i=r.props,l=i.t,o=i.allModels,s=new ie.a,c=n[0],d=s.add(s.trim).add(s.required,l("Required field, cannot be left empty.")).add(s.bail).add(s.textLength,l("Can be max {{length}} characters long.",{length:ae.a.maxMicroTxtLength}),{max:ae.a.maxMicroTxtLength}).add(s.bail).add(s.regex,l("Only numbers, letters, spaces and underscore '_' characters allowed."),{regex:/^[A-Za-z0-9_ ]+$/}).add(s.bail).add(s.notStartsWith,l("Model names cannot start with underscore (_) character."),{searchStr:"_"}).validate(e);if(d)return d;if(a&&a.toLowerCase()===e.toLowerCase())return null;for(var u=0;u<o.length;u++){var p=o[u];if(p.name.toLowerCase()===e.toLowerCase()&&c._id!==p._id)return l("Model with the provided name already exists")}return null};var o="copy",s=e.modelDefinition?Object(i.a)(e.modelDefinition):[];return e.modelDefinition&&e.modelDefinition.length>0&&(o="edit"),r.state={oldModelName:null,modelName:"",modelNameError:null,currentModels:s,normalizedList:[],step:o,jsonText:"",json:null,jsonError:null,selectedEntry:null,anchorEl:null,jsonPasted:!1},r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this.state.currentModels;if(e.length>0){var t=[];this.buildNormalizedList(t,e[0]);var n=e[0].name,a=this.validateName(n);this.setState({normalizedList:t,modelName:n,modelNameError:a})}}},{key:"buildNormalizedList",value:function(e,t){for(var n=0;n<t.fields.length;n++){var i=t.fields[n];if(e.push({field:Object(a.a)({},i),parent:Object(a.a)({},t)}),"object"===i.type||"object-list"===i.type){var l=this.getModel("object"===i.type?i.object.iname:i.objectList.iname);l&&this.buildNormalizedList(e,l)}}}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.state.currentModels,t=this.props,n=t.classes,a=t.t,i=t.open,l=t.handleClose,r=t.fullWidth,o=t.maxWidth,s=t.width;return d.a.createElement(L.a,{fullWidth:r,maxWidth:o,fullScreen:"xs"===s,open:i,onClose:function(e,t){if("backdropClick"===t)return!1;l()},"aria-labelledby":"edit-model-dialog",classes:{paper:"xs"===s?null:n.dialogPaper}},d.a.createElement(_.a,{id:"edit-model-dialog"},d.a.createElement(A.a,{component:"span",variant:"h6"},e.length>0?a("Edit model definition"):a("Define model")),d.a.createElement(W.a,{"aria-label":"close",className:n.closeButton,onClick:this.onClose},d.a.createElement(X.a,{icon:Y.x,className:n.closeButtonIcon}))),d.a.createElement(F.a,{classes:{root:n.dialogContentRoot}},this.renderContents()),this.renderActions())}},{key:"renderContents",value:function(){var e=this.state.step;return"copy"===e?this.renderCopyJson():"confirm"===e||"edit"===e?this.renderModelHierarchy():null}},{key:"renderCopyJson",value:function(){var e=this,t=this.state.jsonText,n=this.props,a=n.t,i=n.theme,l=n.classes;return d.a.createElement(d.a.Fragment,null,d.a.createElement("div",{className:l.bottomMargin},d.a.createElement(U.a,{severity:"info",icon:!1},a("Copy a sample JSON document to auto-generate model definition."))),d.a.createElement(N.a,{mode:"json",theme:"light"===i.palette.type?"xcode":"monokai",name:"request_body",width:"100%",height:"100%",fontSize:13,showPrintMargin:!1,showGutter:!0,highlightActiveLine:!0,value:t,readOnly:!1,setOptions:{showLineNumbers:!0,tabSize:2,fontFamily:"monospace"},onChange:this.handleJsonChange,onPaste:function(){return e.setState({jsonPasted:!0})}}),d.a.createElement("div",{className:l.helperText},this.getHelperText()))}},{key:"renderModelHierarchy",value:function(){var e=this,t=this.state,n=t.normalizedList,a=t.modelName,i=t.modelNameError,l=this.props,r=l.t,o=l.classes,s=l.theme,c=l.width;return d.a.createElement(d.a.Fragment,null,d.a.createElement("div",{style:{marginBottom:s.spacing(2)}},d.a.createElement(D.a,{color:"dark"===s.palette.type?"secondary":"primary",variant:"filled",margin:"dense",fullWidth:!0,name:"modelName",label:"Model name",id:"modelName",autoComplete:"off",onChange:this.onModelNameChange,value:a,InputLabelProps:{shrink:!0},inputProps:{spellCheck:"false",style:{fontSize:"xs"===c||"sm"===c?s.typography.body1.fontSize:s.typography.body2.fontSize}},helperText:i?d.a.createElement("span",{style:{color:s.palette.error.main}},i):d.a.createElement("span",null,r("Name of the custom model"))})),d.a.createElement("div",{className:o.hierarchyHolder},d.a.createElement(I.a,{stickyHeader:!0,size:"small",style:{tableLayout:"fixed"}},d.a.createElement(R.a,null,d.a.createElement(H.a,null,d.a.createElement(B.a,{className:Object(u.default)(o.noWrap,o.padding)},d.a.createElement(X.a,{icon:K.ld,className:o.tableHeadIcon}),r("Field name")),d.a.createElement(G.a,{xsDown:!0},d.a.createElement(B.a,{className:Object(u.default)(o.noWrap,o.padding)},r("Sample value"))),d.a.createElement(B.a,{className:Object(u.default)(o.noWrap,o.padding)},d.a.createElement(X.a,{icon:K.Cb,className:o.tableHeadIcon}),r("Field type")),d.a.createElement(B.a,{width:"50px",align:"center",className:o.noPadding},"\xa0"))),d.a.createElement(P.a,null,n.map((function(t){return d.a.createElement(H.a,{key:t.field._id},d.a.createElement(B.a,{className:Object(u.default)(o.noWrap,o.padding)},d.a.createElement("div",{className:o.noWrap,style:{paddingLeft:s.spacing(2)*t.field.hierarchyLevel,fontWeight:"object"===t.field.type||"object-list"===t.field.type?700:400,fontStyle:"object"===t.field.type||"object-list"===t.field.type?"italic":"normal"}},t.field.name)),d.a.createElement(G.a,{xsDown:!0},d.a.createElement(B.a,{className:Object(u.default)(o.noWrap,o.padding)},void 0===t.field.sampleValue?"":null===t.field.sampleValue?r("null"):"basic-values-list"===t.field.type?t.field.sampleValue:"text"===t.field.type?'"'+t.field.sampleValue.toString()+'"':t.field.sampleValue.toString())),d.a.createElement(B.a,{className:Object(u.default)(o.noWrap,o.padding)},e.renderType(t)),d.a.createElement(B.a,{align:"center",className:o.noPadding},d.a.createElement(W.a,{className:o.deleteButton,onClick:function(){return e.deleteFieldEntry(t)}},d.a.createElement(X.a,{icon:K.wd}))))}))),this.renderTypeSelectMenu())))}},{key:"renderType",value:function(e){var t=this,n=this.props,a=n.t,i=n.theme,l=n.classes,r=e.field,o=("object"===r.type||"object-list"===r.type||"boolean"===r.type||"decimal"===r.type||"email"===r.type||"link"===r.type||"datetime"===r.type||"id"===r.type||"parent"===r.type||"geo-point"===r.type)&&r.fixedType,s=Object($.c)(a,r);return"basic-values-list"===r.type&&(s=s+" ("+r.basicValuesList.type+")"),d.a.createElement(J.a,{size:"small",label:d.a.createElement("span",null,d.a.createElement(X.a,{icon:Object($.d)(r),style:{marginRight:i.spacing(.5)},fixedWidth:!0,className:Object($.e)(l,r)}),s,!1===o&&d.a.createElement(X.a,{icon:Z.d,style:{marginLeft:i.spacing(.5)},fixedWidth:!0})),style:{backgroundColor:"light"===i.palette.type?i.palette.action.selected:i.palette.background.layer2,color:i.palette.text.primary,fontWeight:400,fontSize:i.typography.body2.fontSize},disabled:o,clickable:!o,onClick:o?null:function(n){return t.showTypeSelectMenu(n,e)}})}},{key:"renderTypeSelectMenu",value:function(){var e=this,t=this.state,n=t.anchorEl,a=t.selectedEntry,i=this.props.t;if(!a)return null;var l=[{type:"boolean",text:!1,integer:!1,bvl:!0},{type:"integer",text:!1,integer:!0,bvl:!0},{type:"text",text:!0,integer:!1,bvl:!0},{type:"id",text:!0,integer:!1,bvl:!1},{type:"decimal",text:!1,integer:!0,bvl:!0},{type:"monetary",text:!1,integer:!0,bvl:!1},{type:"datetime",text:!1,integer:!0,bvl:!0},{type:"rich-text",text:!0,integer:!1,bvl:!1},{type:"encrypted-text",text:!0,integer:!1,bvl:!1},{type:"email",text:!0,integer:!1,bvl:!0},{type:"link",text:!0,integer:!1,bvl:!0},{type:"reference",text:!1,integer:!1,bvl:!1},{type:"file",text:!1,integer:!1,bvl:!1}];return d.a.createElement(q.a,{id:"selectFieldTypePopUp",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:this.hideTypeSelectMenu,elevation:4,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},d.a.createElement(ne.a,{onClick:this.closeModelMenu,icon:null},i("Basic")),d.a.createElement(te.a,{icon:Object($.d)("text"),text:i("Text field"),parentMenuOpen:Boolean(n)},l.filter((function(e){return e.text})).map((function(t,n){return d.a.createElement(ee.a,{key:"text"+n,onClick:function(){return e.setType(a,t.type)},icon:Object($.d)(t.type),selected:t.type===a.field.type},Object($.c)(i,t.type))}))),d.a.createElement(ee.a,{onClick:function(){return e.setType(a,"boolean")},icon:Object($.d)("boolean"),selected:"boolean"===a.field.type},Object($.c)(i,"boolean")),d.a.createElement(ee.a,{onClick:function(){return e.setType(a,"integer")},icon:Object($.d)("integer"),selected:"integer"===a.field.type},Object($.c)(i,"integer")),d.a.createElement(ee.a,{onClick:function(){return e.setType(a,"decimal")},icon:Object($.d)("decimal"),selected:"decimal"===a.field.type},Object($.c)(i,"decimal")),d.a.createElement(ee.a,{onClick:function(){return e.setType(a,"monetary")},icon:Object($.d)("monetary"),selected:"monetary"===a.field.type},Object($.c)(i,"monetary")),d.a.createElement(ee.a,{onClick:function(){return e.setType(a,"datetime")},icon:Object($.d)("datetime"),selected:"datetime"===a.field.type},Object($.c)(i,"datetime")),d.a.createElement(Q.a,null),d.a.createElement(ne.a,{onClick:this.closeModelMenu,icon:null},i("Advanced")),d.a.createElement(ee.a,{onClick:function(){return e.setType(a,"reference")},icon:Object($.d)("reference"),selected:"reference"===a.field.type},Object($.c)(i,"reference")),d.a.createElement(te.a,{icon:Object($.d)("enum"),text:Object($.c)(i,"enum"),parentMenuOpen:Boolean(n)},d.a.createElement(ee.a,{onClick:function(){return e.setOptionType(a,"single")},selected:a.field.enumeration&&!1===a.field.enumeration.allowMultiSelect},i("Single option select")),d.a.createElement(ee.a,{onClick:function(){return e.setOptionType(a,"multi")},selected:a.field.enumeration&&!0===a.field.enumeration.allowMultiSelect},i("Multi option select"))),d.a.createElement(te.a,{icon:Object($.d)("basic-values-list"),text:Object($.c)(i,"basic-values-list"),parentMenuOpen:Boolean(n)},l.filter((function(e){return e.bvl})).sort((function(e,t){var n=e.type.toLowerCase(),a=t.type.toLowerCase();return n<a?-1:n>a?1:0})).map((function(t,n){return d.a.createElement(ee.a,{key:"bvl"+n,onClick:function(){return e.setBvlType(a,t.type)},icon:Object($.d)(t.type),selected:a.field.basicValuesList&&t.type===a.field.basicValuesList.type},Object($.c)(i,t.type))}))),d.a.createElement(ee.a,{onClick:function(){return e.setType(a,"file")},icon:Object($.d)("file"),selected:"file"===a.field.type},Object($.c)(i,"file")))}},{key:"renderActions",value:function(){var e=this,t=this.state,n=t.step,a=t.json,i=t.jsonError,l=t.currentModels,r=this.props,o=r.t,s=r.classes;return"copy"===n?d.a.createElement(V.a,{className:s.dialogActions},d.a.createElement("div",{className:s.leftAction},d.a.createElement(z.a,{variant:"contained",disableElevation:!0,onClick:this.onClose},o("Cancel"))),d.a.createElement(z.a,{variant:"contained",disableElevation:!0,color:"primary",onClick:this.convertJsonToModel,disabled:null!==i||null===a},o("Next"))):"confirm"===n?d.a.createElement(V.a,{className:s.dialogActions},d.a.createElement("div",{className:s.leftAction},d.a.createElement(z.a,{variant:"contained",disableElevation:!0,onClick:this.onClose},o("Cancel"))),d.a.createElement(z.a,{variant:"contained",disableElevation:!0,onClick:function(){return e.setState({step:"copy"})}},o("Previous")),d.a.createElement(z.a,{variant:"contained",disableElevation:!0,color:"primary",onClick:this.onSubmit},o("Finish"))):"edit"===n?d.a.createElement(V.a,{className:s.dialogActions},"edit"===n&&d.a.createElement("div",{className:s.leftAction},d.a.createElement(z.a,{type:"submit",variant:"contained",disableElevation:!0,color:"primary",onClick:function(){return e.setState({oldModelName:l&&l.length>0?l[0].name:null,modelName:"",modelNameError:null,currentModels:[],normalizedList:[],step:"copy",jsonText:"",json:null,jsonError:null,selectedEntry:null,anchorEl:null})}},o("Define new"))),d.a.createElement(z.a,{variant:"contained",disableElevation:!0,color:"primary",onClick:this.onSubmit},o("OK")),d.a.createElement(z.a,{variant:"contained",disableElevation:!0,onClick:this.onClose},o("Cancel"))):void 0}},{key:"buildModel",value:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;t.push(n);for(var l=Object.keys(a),r=0;r<l.length;r++){var o=l[r],s=a[o];if(o&&o.trim()){var c=this.getNewId(),d=this.getFieldType(s);if(null!==d){var u=this.creteFieldJson(o,c,d);if(u.hierarchyLevel=i,"object"===u.type||"object-list"===u.type||"id"===u.type&&"_id"===u.name||"geo-point"===u.type?u.fixedType=!0:u.fixedType=!1,"object"===d){var p=this.createModelJson(o,this.getNewId(),n.iname,"sub-model-object");u.object={},u.object.iname=p.iname,e.push({field:u,parent:n}),this.buildModel(e,t,p,s,i+1)}else if("object-list"===d){var m=s[0],f=this.createModelJson(o,this.getNewId(),n.iname,"sub-model-list");u.objectList={},u.objectList.iname=f.iname,e.push({field:u,parent:n}),this.buildModel(e,t,f,m,i+1)}else null!==s&&void 0!==s?Array.isArray(s)?u.sampleValue=JSON.stringify(s):u.sampleValue=s.toString():u.sampleValue=s,e.push({field:u,parent:n});n.fields.push(u)}}}}},{key:"getFieldType",value:function(e){if(null===e||""===e)return"text";if(Array.isArray(e)){if(0===e.length)return"basic-values-list-text";var t=e[0];if(Array.isArray(t))return null;if("object"===typeof t)return"object-list";var n=this.getFieldType(t);return["text","boolean","integer","decimal","datetime","email","link","id"].includes(n)?"basic-values-list-"+n:null}return"object"===typeof e?e.type&&"string"===typeof e.type&&"point"===e.type.toLowerCase()&&e.coordinates&&Array.isArray(e.coordinates)&&2===e.coordinates.length?"geo-point":"object":this.isIntegerValue(e)?"integer":this.isDecimalValue(e)?"decimal":this.isBooleanValue(e)?"boolean":this.isDtmValue(e)?"datetime":this.isIdValue(e)?"id":this.isEmailValue(e)?"email":this.isLinkValue(e)?"link":"text"}},{key:"isIntegerValue",value:function(e){if("number"===typeof e){var t=e.toString();return x()(t)}return!1}},{key:"isDecimalValue",value:function(e){if("number"===typeof e){var t=e.toString();return j()(t)}return!1}},{key:"isBooleanValue",value:function(e){return"boolean"===typeof e}},{key:"isDtmValue",value:function(e){return"string"===typeof e&&(!!C()(e)||!!w()(e))}},{key:"isIdValue",value:function(e){if("string"!==typeof e)return!1;try{var t=e.toString().trim(),n=m()(t);return!(!n||n.toHexString()!==t||!m.a.isValid(n))}catch(a){return!1}}},{key:"isEmailValue",value:function(e){return"string"===typeof e&&v()(e)}},{key:"isLinkValue",value:function(e){return"string"===typeof e&&S()(e)}},{key:"isEmpty",value:function(e){for(var t in e)return!1;return!0}},{key:"createModelJson",value:function(e,t,n,a){return{_id:this.getNewId(),subType:"input",transient:!0,name:e,iname:t,parentiname:n,type:a,fields:[]}}},{key:"creteFieldJson",value:function(e,t,n){if(n.startsWith("basic-values-list")){var a=n.lastIndexOf("-"),i=n.substring(a+1);return{_id:this.getNewId(),type:"basic-values-list",transient:!0,name:e,iname:t,basicValuesList:{type:i}}}return{_id:this.getNewId(),type:n,transient:!0,name:e,iname:t}}},{key:"getNewId",value:function(){return m()().toHexString()}},{key:"getHelperText",value:function(){var e=this.props,t=e.t,n=e.theme,a=this.state,i=a.jsonError;return a.json?d.a.createElement("span",{style:{color:n.palette.success.main}},d.a.createElement(X.a,{icon:K.H,style:{marginRight:n.spacing(.5)}})," ",t("Valid JSON document")):i?d.a.createElement("span",{style:{color:n.palette.error.main}},d.a.createElement(X.a,{icon:K.rd,style:{marginRight:n.spacing(.5)}})," ",t("Not a valid JSON document. %s").sprintf(i)):t("Copy and paste sample output JSON document to automatically generate the model definition")}},{key:"deleteFieldEntry",value:function(e){var t=this.state,n=t.normalizedList,l=t.currentModels;if("object"!==e.field.type&&"object-list"!==e.field.type){var r=n.filter((function(t){return t.field._id!==e.field._id})),o=l.map((function(t){if(t._id===e.parent._id){var n=Object(a.a)({},t);return n.fields=n.fields.filter((function(t){return t._id!==e.field._id})),n}return t}));this.setState({normalizedList:r,currentModels:o})}else{var s="object"===e.field.type?this.getFieldsToDelete(this.getModel(e.field.object.iname)):this.getFieldsToDelete(this.getModel(e.field.objectList.iname));s.push(e.field);for(var c=n.filter((function(e){for(var t=0;t<s.length;t++){var n=s[t];if(e.field._id===n._id)return!1}return!0})),d=Object(i.a)(l),u=function(e){var t=s[e];"object"===t.type?d=d.filter((function(e){return e.iname!==t.object.iname})):"object-list"===t.type&&(d=d.filter((function(e){return e.iname!==t.objectList.iname})))},p=0;p<s.length;p++)u(p);d=d.map((function(t){if(t._id===e.parent._id){var n=Object(a.a)({},t);return n.fields=n.fields.filter((function(t){return t._id!==e.field._id})),n}return t})),this.setState({normalizedList:c,currentModels:d})}}},{key:"getFieldsToDelete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return t;for(var n=0;n<e.fields.length;n++){var a=e.fields[n];t.push(a),"object"===a.type?this.getFieldsToDelete(this.getModel(a.object.iname),t):"object-list"===a.type&&this.getFieldsToDelete(this.getModel(a.objectList.iname),t)}return t}},{key:"getModel",value:function(e){for(var t=this.state.currentModels,n=0;n<t.length;n++){var a=t[n];if(a.iname===e)return a}return null}},{key:"setType",value:function(e,t){var n=this.state,i=n.normalizedList,l=n.currentModels,r=i.map((function(n){if(n.field._id===e.field._id){var i=Object(a.a)({},n);return i.field.type=t,delete i.field.basicValuesList,delete i.field.enumeration,i}return n})),o=l.map((function(n){if(n._id===e.parent._id){var i=Object(a.a)({},n);return i.fields=i.fields.map((function(n){if(n._id===e.field._id){var i=Object(a.a)({},n);return i.type=t,delete i.basicValuesList,delete i.enumeration,i}return n})),i}return n}));this.setState({normalizedList:r,currentModels:o,selectedEntry:null,anchorEl:null})}},{key:"setBvlType",value:function(e,t){var n=this.state,i=n.normalizedList,l=n.currentModels,r=i.map((function(n){if(n.field._id===e.field._id){var i=Object(a.a)({},n);return i.field.type="basic-values-list",delete i.field.enumeration,i.field.basicValuesList={type:t},i}return n})),o=l.map((function(n){if(n._id===e.parent._id){var i=Object(a.a)({},n);return i.fields=i.fields.map((function(n){if(n._id===e.field._id){var i=Object(a.a)({},n);return i.type="basic-values-list",delete i.enumeration,i.basicValuesList={type:t},i}return n})),i}return n}));this.setState({normalizedList:r,currentModels:o,selectedEntry:null,anchorEl:null})}},{key:"setOptionType",value:function(e,t){var n=this.state,i=n.normalizedList,l=n.currentModels,r=i.map((function(n){if(n.field._id===e.field._id){var i=Object(a.a)({},n);return i.field.type="enum",delete i.field.basicValuesList,i.field.enumeration={allowMultiSelect:"multi"===t,selectList:[],restrictToList:!0},i}return n})),o=l.map((function(n){if(n._id===e.parent._id){var i=Object(a.a)({},n);return i.fields=i.fields.map((function(n){if(n._id===e.field._id){var i=Object(a.a)({},n);return i.type="enum",delete i.basicValuesList,i.enumeration={allowMultiSelect:"multi"===t,selectList:[],restrictToList:!0},i}return n})),i}return n}));this.setState({normalizedList:r,currentModels:o,selectedEntry:null,anchorEl:null})}},{key:"showTypeSelectMenu",value:function(e,t){this.setState({selectedEntry:t,anchorEl:e.currentTarget})}}]),n}(d.a.PureComponent);le.defaultProps={allModels:null,handleClose:null,callback:null,modelDefinition:null},t.a=Object(y.a)()(Object(f.a)((function(e){return{dialogPaper:{minHeight:"700px"},closeButton:{position:"absolute",right:e.spacing(2),padding:e.spacing(.5),color:e.palette.grey[400]},closeButtonIcon:{width:"24px",height:"24px",minWidth:"24px"},dialogContentRoot:{"&:first-child":{paddingTop:8},display:"flex",flexDirection:"column",flexGrow:1,height:"580px"},dialogActions:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3),paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},leftAction:{flexGrow:1},hierarchyHolder:{flexGrow:1,overflow:"auto"},tableHeadIcon:{marginRight:e.spacing(.5)},noWrap:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},padding:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},noPadding:{padding:0},nodeSystem:{color:e.palette.text.disabled},nodeBasic:{color:e.palette.success.main},nodeAdvanced:{color:e.palette.warning.main},nodeObject:{color:"light"===e.palette.type?e.palette.primary.main:e.palette.primary.linkForDark},deleteButton:{padding:e.spacing(1),fontSize:e.typography.body1.fontSize,color:"light"===e.palette.type?e.palette.text.secondary:e.palette.primary.linkForDark},helperText:{marginTop:e.spacing(.5),fontSize:e.typography.caption.fontSize,color:e.palette.text.disabled},bottomMargin:{marginBottom:e.spacing(2)}}}),{withTheme:!0})(Object(h.a)()(le)))}}]);